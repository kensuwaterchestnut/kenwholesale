<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²</title>
  <meta name="description" content="å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²ï¼šå¸¸æº«ã€å†·è—ã€å†·å‡èˆ‡è¶…å•†å–è²¨å¤šç¨®å“é …ï¼Œä¸‹å–®å¾Œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ã€‚" />
  <style>
    :root{
      --bg:#faf7f2; --surface:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#f59e0b; --brand-dark:#d97706; --ok:#16a34a; --bad:#ef4444;
      --border:#e5e7eb; --shadow:0 12px 28px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px}

    /* ===== Header ===== */
    header{position:sticky;top:0;z-index:60;background:rgba(255,255,255,.86);backdrop-filter:saturate(1.2) blur(10px);border-bottom:1px solid var(--border)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:44px;height:44px;object-fit:contain;border-radius:10px;border:1px solid var(--border);background:#fff}
    .brand h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.5px}
    nav{display:flex;gap:14px;font-size:14px}
    nav a{padding:6px 10px;border-radius:9px;border:1px solid transparent}
    nav a:hover{border-color:var(--border);background:#fff}

    /* ===== Hero ===== */
    .hero{position:relative;margin:0 0 18px;background:linear-gradient(180deg,#fff,rgba(255,255,255,0)),url('https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?q=80&w=1600&auto=format&fit=crop');
      background-size:cover;background-position:center;min-height:44svh;border-bottom:1px solid var(--border)}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,.35),rgba(0,0,0,.0) 55%)}
    .hero .hero-inner{position:relative;z-index:1;display:grid;align-items:end;min-height:44svh}
    .hero .copy{padding:28px 0 30px;color:#fff}
    .hero .kicker{display:inline-block;background:rgba(0,0,0,.35);padding:6px 10px;border:1px solid rgba(255,255,255,.25);border-radius:999px;font-size:12px;margin-bottom:12px}
    .hero h2{font-size: clamp(28px, 4.6vw, 48px); line-height:1.15;margin:0 0 8px;font-weight:900;text-shadow:0 2px 12px rgba(0,0,0,.22)}
    .hero p{margin:0;font-size:clamp(14px,2.5vw,16px);opacity:.95}
    .cta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn.brand{background:var(--brand);color:#111;border:1px solid var(--brand-dark)}
    .btn.ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.35)}

    /* ===== Filters / chips ===== */
    .chips{display:flex;gap:8px;flex-wrap:wrap;padding:14px 0 6px}
    .chip{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:13px;cursor:pointer}
    .chip.is-on{border-color:var(--brand);box-shadow:0 2px 10px rgba(245,158,11,.25)}

    /* ===== Grid / Cards ===== */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px 14px}
    @media (min-width:860px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{position:relative;background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card .media{aspect-ratio:4/3;background:#f3f4f6;display:grid;place-items:center;overflow:hidden}
    .card .media img{width:100%;height:100%;object-fit:cover}
    .soldout{position:absolute;inset:auto 10px 10px auto;background:rgba(17,24,39,.85);color:#fff;padding:6px 10px;border-radius:10px;font-size:12px;z-index:2}
    .badge{position:absolute;left:10px;top:10px;background:#fff;border:1px solid var(--border);font-size:12px;border-radius:999px;padding:4px 8px}
    .body{padding:12px}
    .body h3{margin:0 0 4px;font-size:16px}
    .meta{color:var(--muted);font-size:12px}
    .price{margin-top:6px;font-weight:800;color:#b45309}
    .btn.add{margin:10px 0 2px;background:#111;color:#fff;border-radius:12px;padding:10px 12px;border:1px solid #111}
    .btn.add[disabled]{background:#cfcfcf;border-color:#cfcfcf;cursor:not-allowed}
    .note{font-size:12px;color:var(--muted)}

    /* ===== Floating Cart (orange icon) ===== */
    .cart-fab{position:fixed;right:16px;bottom:16px;z-index:80;display:grid;place-items:center;width:64px;height:64px;border-radius:50%;background:#ffedd5;border:2px solid var(--brand-dark);box-shadow:0 10px 24px rgba(0,0,0,.18);cursor:pointer}
    .cart-fab svg{width:36px;height:36px}
    .cart-count{position:absolute;right:-6px;top:-6px;background:#111;color:#fff;border-radius:999px;min-width:24px;height:24px;display:grid;place-items:center;font-size:12px;border:2px solid #fff}

    /* ===== Cart Drawer ===== */
    .drawer{position:fixed;inset:0;z-index:90;display:none}
    .drawer.on{display:block}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.36)}
    .panel{position:absolute;right:0;top:0;bottom:0;width:min(520px,100%);background:#fff;box-shadow:-12px 0 28px rgba(0,0,0,.25);display:flex;flex-direction:column}
    .panel header{padding:14px 14px;border-bottom:1px solid var(--border);background:#fff;display:flex;align-items:center;justify-content:space-between}
    .panel header h4{margin:0;font-size:18px}
    .list{flex:1;overflow:auto;padding:12px}
    .item{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:8px;margin-bottom:8px}
    .qty{display:flex;align-items:center;gap:6px}
    .qty button{width:28px;height:28px;border:1px solid var(--border);background:#fff;border-radius:8px;cursor:pointer}
    .summary{border-top:1px dashed var(--border);padding:12px}
    .row{display:flex;justify-content:space-between;font-size:14px;margin:6px 0}
    .row em{color:var(--muted);font-style:normal}
    .row .ok{color:var(--ok)} .row .warn{color:#b45309}
    .checkout{padding:12px;border-top:1px solid var(--border);}
    .btn.full{width:100%;background:var(--brand);border:1px solid var(--brand-dark);color:#111;font-weight:900}

    /* ===== Checkout (Step 2) ===== */
    .sheet{position:fixed;inset:0;z-index:95;display:none}
    .sheet.on{display:block}
    .sheet .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.36)}
    .sheet .card{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(720px,96%);max-height:90svh;overflow:auto;padding:16px;border-radius:16px;background:#fff;border:1px solid var(--border);box-shadow:var(--shadow)}
    .form{display:grid;grid-template-columns:1fr;gap:10px}
    .label{font-size:12px;color:var(--muted)}
    .input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;font:inherit;background:#fff}
    .bank{margin:6px 0 0;font-size:13px;border:1px dashed var(--border);border-radius:12px;padding:10px;background:#fffced}
    .fine{font-size:12px;color:var(--muted)}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    /* ===== Admin (local only) ===== */
    .admin-badge{position:fixed;left:10px;bottom:10px;z-index:85;opacity:.6}
    .admin-pane{position:fixed;left:10px;bottom:54px;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:10px;display:none;max-width:92vw}
    .admin-pane.on{display:block}
    .admin-pane h5{margin:0 0 6px}
    .admin-pane small{color:var(--muted)}
    .admin-pane textarea{width:min(72ch,80vw);height:140px}
  </style>
</head>
<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <img id="logoImg" src="https://i.imgur.com/9Xx0m3H.png" alt="KenSu Logo"/>
        <h1 id="siteTitle">å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²</h1>
      </div>
      <nav>
        <a href="#store">é¦¬ä¸Šé¸è³¼</a>
        <a href="#about">é—œæ–¼æˆ‘å€‘</a>
        <a href="#news">æœ€æ–°é®®å ±</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap hero-inner">
      <div class="copy">
        <span class="kicker" id="heroKicker">KenSu Wholesale</span>
        <h2 id="heroTitle">å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†</h2>
        <p id="heroSub">æ•´ä»¶æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡ãƒ»è¶…å•†å–è²¨ â€” å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„3â€“5å€‹å·¥ä½œå¤©ï¼‰</p>
        <div class="cta">
          <button class="btn brand" onclick="scrollToStore()">ğŸ›’ é¦¬ä¸Šé¸è³¼</button>
          <button class="btn ghost" onclick="document.getElementById('about').scrollIntoView({behavior:'smooth'})">å“ç‰Œæ•…äº‹</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters / Chips -->
  <section class="wrap" id="store">
    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- About / News -->
  <section class="wrap" id="about" style="padding:28px 0 8px">
    <h3>é—œæ–¼æˆ‘å€‘</h3>
    <p>å•ƒé…¥å¾å¤œå¸‚å°æ”¤ç™¼è·¡ï¼Œä¸»æ‰“è±è§’é…¥ã€èŠ‹æ³¥é…¥ã€ç‚¸é®®å¥¶èˆ‡é£²å“åŸæ–™ã€‚ç‚ºäº†è®“æ›´å¤šéåŠ ç›Ÿå¤¥ä¼´ä¹Ÿèƒ½ç©©å®šå–å¾—åŸç‰©æ–™ï¼Œæˆ‘å€‘é–‹æ”¾<strong>æ•´ä»¶æ‰¹ç™¼</strong>ä¸‹å–®ã€‚å®Œæˆä¸‹å–®å¾Œï¼Œè«‹ä¾ç•«é¢é¡¯ç¤ºåŒ¯æ¬¾è³‡è¨Šå®ŒæˆåŒ¯æ¬¾ï¼›æˆ‘å€‘æ ¸å¸³å¾Œæ‰æœƒå®‰æ’å‡ºè²¨ã€‚</p>
  </section>
  <section class="wrap" id="news" style="padding:0 0 80px">
    <h3>æœ€æ–°é®®å ±</h3>
    <ul>
      <li>ğŸ§Š å†·è—/å†·å‡å“éœ€å…¨ç¨‹ä½æº«é…é€ï¼›ä¸åŒæº«å±¤æ•ç„¡æ³•åˆä½µå‡ºè²¨èˆ‡é‹è²»ã€‚</li>
      <li>ğŸšš å…é‹è¦å‰‡ï¼šä¾<strong>æº«å±¤ç¾¤çµ„</strong>è¨ˆç®—ï¼Œé”å„ç¾¤çµ„é–€æª»å³å…é‹ï¼ˆè¦å‰‡å¯«åœ¨ç”¢å“å¡ï¼‰ã€‚</li>
      <li>ğŸ“¦ å‡ºè²¨æ™‚ç¨‹ï¼šæ ¸å¸³å¾Œç´„ 3â€“5 å€‹å·¥ä½œå¤©ã€‚æ€¥ä»¶è«‹å…ˆæ–¼å³ä¸‹è§’ç•™è¨€èˆ‡æˆ‘å€‘ç¢ºèªã€‚</li>
    </ul>
  </section>

  <!-- Floating Cart (Orange) -->
  <button class="cart-fab" id="cartFab" title="é–‹å•Ÿè³¼ç‰©è»Š" onclick="openCart()">
    <span class="cart-count" id="cartCount">0</span>
    <!-- å°æ©˜å­ + è»Š -->
    <svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <circle cx="64" cy="64" r="36" fill="#f59e0b" stroke="#d97706" stroke-width="6" />
      <path d="M20 36h16l10 46h42l6-28H54" fill="none" stroke="#111" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="52" cy="96" r="6" fill="#111"/><circle cx="88" cy="96" r="6" fill="#111"/>
      <path d="M64 22c-10 0-18 8-18 18 10-6 20-6 36 0-2-10-10-18-18-18z" fill="#fed7aa" stroke="#d97706" stroke-width="4"/>
    </svg>
  </button>

  <!-- Cart Drawer -->
  <div class="drawer" id="drawer">
    <div class="backdrop" onclick="closeCart()"></div>
    <div class="panel">
      <header>
        <h4>è³¼ç‰©è»Š</h4>
        <button class="btn" onclick="closeCart()">é—œé–‰</button>
      </header>
      <div class="list" id="cartList"></div>
      <div class="summary" id="cartSummary"></div>
      <div class="checkout">
        <button class="btn full" onclick="goCheckout()">å‰å¾€çµå¸³ï¼ˆå…ˆå¡«è³‡æ–™å¾ŒåŒ¯æ¬¾ï¼‰</button>
      </div>
    </div>
  </div>

  <!-- Checkout Sheet -->
  <div class="sheet" id="sheet">
    <div class="backdrop" onclick="closeSheet()"></div>
    <div class="card">
      <h3 style="margin:6px 0 10px">å¡«å¯«å‡ºè²¨è³‡æ–™</h3>
      <form id="orderForm" class="form" onsubmit="submitOrder(event)">
        <div class="two">
          <div><div class="label">å…¬å¸/åº—åï¼ˆæˆ–å§“åï¼‰</div><input class="input" name="buyer" required></div>
          <div><div class="label">è¯çµ¡é›»è©±</div><input class="input" name="phone" required></div>
        </div>
        <div class="two">
          <div><div class="label">Emailï¼ˆæ”¶é€šçŸ¥ï¼‰</div><input class="input" name="email" type="email" required></div>
          <div><div class="label">LINE IDï¼ˆé¸å¡«ï¼‰</div><input class="input" name="line"></div>
        </div>
        <div class="two">
          <div><div class="label">æ”¶ä»¶äºº</div><input class="input" name="recipient" required></div>
          <div><div class="label">å‡ºè²¨æ–¹å¼</div>
            <select name="ship_note" class="input" required>
              <option value="å¸¸æº«é…é€">å¸¸æº«é…é€</option>
              <option value="å†·è—é…é€">å†·è—é…é€</option>
              <option value="å†·å‡é…é€">å†·å‡é…é€</option>
              <option value="è¶…å•†å–è²¨">è¶…å•†å–è²¨ï¼ˆé™å¯å¯„å“é …ï¼‰</option>
            </select>
          </div>
        </div>
        <div><div class="label">æ”¶ä»¶åœ°å€ / å–è²¨é–€å¸‚</div><input class="input" name="address" required></div>
        <div><div class="label">å‚™è¨»</div><textarea class="input" name="memo" rows="3" placeholder="å¦‚éœ€çµ±ç·¨æŠ¬é ­ã€æŒ‡å®šåˆ°è²¨æ—¥ã€é–‹ç®±éŒ„å½±ç­‰éœ€æ±‚è«‹å¡«å¯«"></textarea></div>

        <div class="bank">
          <strong>åŒ¯æ¬¾è³‡è¨Šï¼š</strong>
          <div class="fine">æˆ¶åï¼šé…¥å‘³é¦™ä¼æ¥­ç¤¾ï½œéŠ€è¡Œï¼šXXXXï¼ˆä»£ç¢¼ 000ï¼‰ï½œå¸³è™Ÿï¼š0000000000000<br>å®Œæˆé€å‡ºå¾Œè«‹åŒ¯æ¬¾ï¼Œ<b>ç•™è¨€åŒ¯æ¬¾å¾Œäº”ç¢¼</b>ï¼›æˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„ 3â€“5 å€‹å·¥ä½œå¤©ï¼‰ã€‚</div>
        </div>
        <div class="fine">é€å‡ºå¾Œç³»çµ±æœƒå°‡è¨‚å–®å¯«å…¥ Google è©¦ç®—è¡¨ä¸¦å¯„é€ç¢ºèªä¿¡è‡³æ‚¨çš„ä¿¡ç®±ã€‚</div>
        <div class="two">
          <button type="button" class="btn" onclick="closeSheet()">å–æ¶ˆ</button>
          <button type="submit" class="btn brand">é€å‡ºè¨‚å–®ï¼ˆæœªä»˜æ¬¾ä¸å‡ºè²¨ï¼‰</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Admin (local quick edit) -->
  <button class="admin-badge btn" onclick="toggleAdmin()">ğŸ”’ ç®¡ç†å“¡</button>
  <div class="admin-pane" id="adminPane">
    <h5>å¿«é€Ÿè¨­å®šï¼ˆæœ¬æ©Ÿç€è¦½å™¨å„²å­˜ï¼Œå¯è²¼ä¸Š LOGO/æ–‡æ¡ˆï¼Œæˆ–ç›´æ¥ç·¨è¼¯ç”¢å“ JSONï¼‰</h5>
    <div class="fine">ï¼Šæ­£å¼ä¸Šç·šè«‹æ”¹æˆå¾Œç«¯è³‡æ–™åº«æˆ– Google è©¦ç®—è¡¨ã€‚é è¨­å¸³å¯†ï¼š<b>admin / 111111</b></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin:8px 0">
      <input class="input" id="adminUser" placeholder="å¸³è™Ÿï¼šadmin" style="max-width:160px">
      <input class="input" id="adminPass" type="password" placeholder="å¯†ç¢¼ï¼š111111" style="max-width:160px">
      <button class="btn" onclick="adminLogin()">ç™»å…¥</button>
      <button class="btn" onclick="saveBrand()">å„²å­˜å“ç‰Œæ–‡æ¡ˆ</button>
      <button class="btn" onclick="saveProducts()">å„²å­˜ç”¢å“ JSON</button>
    </div>
    <div class="two">
      <div>
        <div class="label">LOGO URL</div>
        <input class="input" id="inpLogo" placeholder="https://...png">
        <div class="label">ç¶²ç«™æ¨™é¡Œ</div>
        <input class="input" id="inpTitle" placeholder="å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²">
        <div class="label">å°é¢ä¸»æ¨™</div>
        <input class="input" id="inpHeroTitle" placeholder="å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†">
        <div class="label">å°é¢å‰¯æ¨™</div>
        <input class="input" id="inpHeroSub" placeholder="æ•´ä»¶æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡â€¦">
      </div>
      <div>
        <div class="label">ç”¢å“è³‡æ–™ï¼ˆJSONï¼Œå¯ç›´æ¥æ”¹åƒ¹ã€æ”¹å”®å®Œ soldOut:trueã€èª¿æ•´å…é‹é–€æª» freeQty ç­‰ï¼‰</div>
        <textarea id="jsonBox"></textarea>
      </div>
    </div>
    <small>æç¤ºï¼šä¿®æ”¹å¾ŒæŒ‰ã€Œå„²å­˜ã€ï¼Œé‡æ–°æ•´ç†é é¢å³å¯çœ‹åˆ°è®Šæ›´ï¼›åªå½±éŸ¿æœ¬æ©Ÿï¼ˆlocalStorageï¼‰ã€‚</small>
  </div>

  <script>
    /* ===========================================================
     * 1) è³‡æ–™æ¨¡å‹ï¼ˆå¯ç”±å¾Œç«¯/Google Sheets ç”¢å‡ºå°æ‡‰ JSONï¼‰
     *    æ¬„ä½èªªæ˜ï¼š
     *    id, name, spec, price, shipGroup('å¸¸æº«'|'å†·è—'|'å†·å‡'|'è¶…å•†'), shipFee, freeQty(é”åˆ°å¹¾ä»¶å…é‹ï¼Œ0=ä¸é©ç”¨), 
     *    minOrder(æœ€å°è³¼è²·ä»¶æ•¸ï¼Œé è¨­1), soldOut, tag(åˆ†é¡å­—æ¯ A/B/C/D/E/F/G), img, noteï¼ˆå¡ç‰‡å³ä¸‹å°å­—ï¼‰
     * =========================================================== */
    const DEFAULT_PRODUCTS = [
      {id:'p01', tag:'A.ç²‰é¡', name:'(æ•´ä»¶)å•ƒé…¥å°ˆç”¨ç²‰', spec:'4.5å…¬æ–¤ / 5åŒ… / 1ä»¶', price:4900, shipGroup:'å¸¸æº«', shipFee:150, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'p02', tag:'C.å†·å‡åŸç‰©æ–™', name:'(æ•´ä»¶)å•ƒé…¥è±è§’ä»', spec:'3å…¬æ–¤ / 4åŒ… / 1ä»¶', price:2400, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'p03', tag:'C.å†·å‡åŸç‰©æ–™', name:'(æ•´ä»¶)å•ƒé…¥ä¹³é…ªä¸', spec:'1å…¬æ–¤ / 10åŒ… / 1ä»¶', price:3800, shipGroup:'å†·è—', shipFee:180, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p04', tag:'C.å†·å‡åŸç‰©æ–™', name:'(æ•´ä»¶)å•ƒé…¥èŠ‹æ³¥ä¸', spec:'750å…¬å…‹ / 18ç›’ / 1ä»¶', price:4960, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p05', tag:'C.å†·å‡åŸç‰©æ–™', name:'(æ•´ä»¶)å•ƒé…¥ç‚¸é®®å¥¶', spec:'6æ¢ / 16ç›’ / 1ä»¶', price:1696, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'p06', tag:'C.å†·å‡åŸç‰©æ–™', name:'(æ•´ä»¶)å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', spec:'330æ¯«å‡ / 10ç“¶ / 1ä»¶', price:750, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p07', tag:'E.åŒ…è£è€—æ', name:'(æ•´ä»¶)4å…©ç´™è¢‹', spec:'5000å€‹ / 1ç®±', price:1900, shipGroup:'å¸¸æº«', shipFee:150, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p08', tag:'E.åŒ…è£è€—æ', name:'(æ•´ä»¶)1æ¯å¡‘è† è¢‹', spec:'3000å€‹ / 1ä»¶', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:1, minOrder:1, soldOut:true, img:'', note:'ç¼ºè²¨'},
      {id:'p09', tag:'E.åŒ…è£è€—æ', name:'(æ•´ä»¶)4å…©å¡‘è† è¢‹', spec:'3000å€‹ / 1ä»¶', price:1000, shipGroup:'å¸¸æº«', shipFee:150, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p10', tag:'E.åŒ…è£è€—æ', name:'(æ•´ä»¶)4å…©ç«¹ç±¤', spec:'20åŒ… / 1ä»¶', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:1, minOrder:1, soldOut:true, img:'', note:'å°±è¿‘å—åŒ—é›œè²¨è³¼è²·'},
      {id:'p11', tag:'F.æ²¹å“', name:'(å–®å“é …)ç¾é£Ÿå®¶è€ç‚¸æ²¹', spec:'18å…¬å‡ / 1æ¡¶', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:0, minOrder:0, soldOut:true, img:'', note:'å°±è¿‘å—åŒ—é›œè²¨è³¼è²·'},
      {id:'p12', tag:'G.èª¿å‘³æ–™', name:'(å–®å“é …)é£›ç‡•ç…‰ä¹³', spec:'1300å…¬å…‹ / 24ç½ / 1ä»¶', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:0, minOrder:0, soldOut:true, img:'', note:'å°±è¿‘å—åŒ—é›œè²¨è³¼è²·'},
      {id:'p13', tag:'D.é£²å“åŸç‰©æ–™', name:'(å–®å“é …)é¦™æ¿ƒå¥¶èŒ¶ç²‰', spec:'600å…‹ / åŒ…', price:200, shipGroup:'è¶…å•†', shipFee:60, freeQty:3, minOrder:1, soldOut:false, img:'', note:'æ»¿3ä»¶å…é‹'},
      {id:'p14', tag:'D.é£²å“åŸç‰©æ–™', name:'(å–®å“é …)å¤§éº¥', spec:'600å…‹ / åŒ…', price:120, shipGroup:'è¶…å•†', shipFee:60, freeQty:3, minOrder:1, soldOut:false, img:'', note:'æ»¿3ä»¶å…é‹'},
      {id:'p15', tag:'D.é£²å“åŸç‰©æ–™', name:'(å–®å“é …)é…¸æ¢…æ¹¯', spec:'160å…‹ / åŒ…', price:135, shipGroup:'è¶…å•†', shipFee:60, freeQty:3, minOrder:1, soldOut:false, img:'', note:'æ»¿3ä»¶å…é‹'},
      {id:'p16', tag:'D.é£²å“åŸç‰©æ–™', name:'(å–®å“é …)ç«ç‘°ä»™æ¸£èŒ¶åŒ…', spec:'20åŒ…', price:250, shipGroup:'è¶…å•†', shipFee:60, freeQty:3, minOrder:1, soldOut:false, img:'', note:'æ»¿3ä»¶å…é‹'},
      {id:'p17', tag:'D.é£²å“åŸç‰©æ–™', name:'(å–®å“é …)é’èŒ¶èŒ¶è‘‰', spec:'600å…‹ / åŒ…', price:280, shipGroup:'è¶…å•†', shipFee:60, freeQty:3, minOrder:1, soldOut:false, img:'', note:'æ»¿3ä»¶å…é‹'},
      {id:'p18', tag:'B.å†·è—åŸç‰©æ–™', name:'(æ•´ä»¶)èŠ‹æ³¥ä¸7ç›’+ä¹³é…ªä¸7ç›’', spec:'å„7åŒ… / 1ä»¶', price:4589, shipGroup:'å†·è—', shipFee:180, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p19', tag:'B.å†·è—åŸç‰©æ–™', name:'(å–®å“é …)åŠ åšè¦é¤…ï¼ˆæ•´ç‰‡åŠæˆå“ï¼‰', spec:'15ç‰‡ / 1åŒ…', price:900, shipGroup:'å†·å‡', shipFee:200, freeQty:4, minOrder:1, soldOut:false, img:'', note:'æ»¿4ä»¶å…é‹'},
      {id:'p20', tag:'G.èª¿å‘³æ–™', name:'(æ•´ä»¶)æ³°å¼é†¬', spec:'1.13å…¬æ–¤ / 15ç½ / 1ä»¶', price:1485, shipGroup:'å¸¸æº«', shipFee:150, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'p21', tag:'G.èª¿å‘³æ–™', name:'(å–®å“é …)æ¤’é¹½æ’’ç²‰', spec:'600å…‹ / 1ç›’', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:10, minOrder:1, soldOut:true, img:'', note:'å°±è¿‘å—åŒ—é›œè²¨è³¼è²·'},
      {id:'p22', tag:'G.èª¿å‘³æ–™', name:'(å–®å“é …)è¾£ç²‰æ’’ç²‰', spec:'â€”', price:150, shipGroup:'å¸¸æº«', shipFee:150, freeQty:10, minOrder:1, soldOut:true, img:'', note:'å°±è¿‘å—åŒ—é›œè²¨è³¼è²·'},
      {id:'p23', tag:'C.å†·å‡åŸç‰©æ–™', name:'(å–®å“é …)å•ƒé…¥ä¹³é…ªä¸', spec:'1å…¬æ–¤ / åŒ…', price:380, shipGroup:'å†·è—', shipFee:180, freeQty:10, minOrder:1, soldOut:false, img:'', note:''},
      {id:'p24', tag:'B.å†·è—åŸç‰©æ–™', name:'(å–®å“é …)å•ƒé…¥èŠ‹æ³¥ä¸', spec:'750å…¬å…‹ / ç›’', price:276, shipGroup:'å†·å‡', shipFee:200, freeQty:18, minOrder:1, soldOut:false, img:'', note:''},
      {id:'p25', tag:'C.å†·å‡åŸç‰©æ–™', name:'(å–®å“é …)å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', spec:'330æ¯«å‡ / ç“¶', price:75, shipGroup:'å†·å‡', shipFee:200, freeQty:10, minOrder:1, soldOut:false, img:'', note:''},
      {id:'p26', tag:'C.å†·å‡åŸç‰©æ–™', name:'(å–®å“é …)å•ƒé…¥ç‚¸é®®å¥¶', spec:'6æ¢ / ç›’', price:106, shipGroup:'å†·å‡', shipFee:200, freeQty:32, minOrder:1, soldOut:false, img:'', note:''}
    ];

    const GROUP_LABELS = { 'å¸¸æº«':'å¸¸æº«', 'å†·è—':'å†·è—', 'å†·å‡':'å†·å‡', 'è¶…å•†':'è¶…å•†å–è²¨' };

    /* ===========================================================
     * 2) ç‹€æ…‹èˆ‡å„²å­˜
     * =========================================================== */
    const LS_KEY_PRODUCTS = 'kensu_wholesale_products_v1';
    const LS_KEY_BRAND = 'kensu_wholesale_brand_v1';

    const brand = loadBrand();
    const products = loadProducts();
    let filterOn = 'å…¨éƒ¨';
    const cart = new Map(); // id -> { product, qty }

    function loadProducts(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY_PRODUCTS)) || DEFAULT_PRODUCTS; }catch{ return DEFAULT_PRODUCTS }
    }
    function loadBrand(){
      try{
        return JSON.parse(localStorage.getItem(LS_KEY_BRAND)) || {
          logo:'', title:'å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡ãƒ»è¶…å•†å–è²¨ â€” å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„3â€“5å€‹å·¥ä½œå¤©ï¼‰'
        };
      }catch{ return {logo:'', title:'å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡ãƒ»è¶…å•†å–è²¨ â€” å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„3â€“5å€‹å·¥ä½œå¤©ï¼‰'} }
    }

    /* ===========================================================
     * 3) åˆå§‹åŒ–ï¼šå“ç‰Œæ–‡æ¡ˆ + ç¯©é¸ + å¡ç‰‡æ¸²æŸ“
     * =========================================================== */
    function applyBrand(){
      if(brand.logo){ document.getElementById('logoImg').src = brand.logo }
      document.getElementById('siteTitle').textContent = brand.title || 'å•ƒé…¥è±è§’é…¥ï½œæ‰¹ç™¼å®˜ç¶²';
      document.getElementById('heroTitle').textContent = brand.heroTitle || '';
      document.getElementById('heroSub').textContent = brand.heroSub || '';
      // ç®¡ç†é¢æ¿é å¡«
      document.getElementById('inpLogo').value = brand.logo || '';
      document.getElementById('inpTitle').value = brand.title || '';
      document.getElementById('inpHeroTitle').value = brand.heroTitle || '';
      document.getElementById('inpHeroSub').value = brand.heroSub || '';
    }

    function uniqueTags(){
      const tags = Array.from(new Set(products.map(p=>p.tag)));
      return ['å…¨éƒ¨', ...tags, 'å¸¸æº«','å†·è—','å†·å‡','è¶…å•†å–è²¨'];
    }

    function renderChips(){
      const chips = document.getElementById('chips');
      chips.innerHTML = '';
      uniqueTags().forEach(t=>{
        const btn = document.createElement('button');
        btn.className = 'chip' + (t===filterOn?' is-on':'');
        btn.textContent = t;
        btn.onclick = ()=>{ filterOn=t; renderGrid(); };
        chips.appendChild(btn);
      });
    }

    function matchFilter(p){
      if(filterOn==='å…¨éƒ¨') return true;
      if(['å¸¸æº«','å†·è—','å†·å‡','è¶…å•†å–è²¨'].includes(filterOn)) return GROUP_LABELS[p.shipGroup]===filterOn;
      return p.tag===filterOn;
    }

    function renderGrid(){
      const grid = document.getElementById('grid');
      grid.innerHTML='';
      products.filter(matchFilter).forEach(p=>{
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <div class="media">
            ${p.img?`<img src="${p.img}" alt="${p.name}">`:`<span style="color:#9ca3af">(å°šæœªä¸Šå‚³åœ–ç‰‡)</span>`}
            <span class="badge">${p.tag}ï½œ${GROUP_LABELS[p.shipGroup]||p.shipGroup}</span>
            ${p.soldOut?`<span class="soldout">å·²å”®å®Œ</span>`:''}
          </div>
          <div class="body">
            <h3>${p.name}</h3>
            <div class="meta">${p.spec}</div>
            <div class="price">$${fmt(p.price)}</div>
            <button class="btn add" ${p.soldOut||p.minOrder===0? 'disabled':''} onclick="addToCart('${p.id}', ${p.minOrder||1})">åŠ å…¥è³¼ç‰©è»Š</button>
            <div class="note">${p.note||''}ï½œé‹è²» $${p.shipFee}${p.freeQty>0?`ãƒ»æ»¿${p.freeQty}ä»¶å…é‹`:''}</div>
          </div>`;
        grid.appendChild(card);
      })
    }

    function fmt(n){ return Number(n).toLocaleString('zh-TW') }

    function scrollToStore(){ document.getElementById('store').scrollIntoView({behavior:'smooth'}) }

    /* ===========================================================
     * 4) è³¼ç‰©è»Šï¼šåŠ å…¥ / æ¸²æŸ“ / é‹è²»è¨ˆç®—ï¼ˆä»¥æº«å±¤ç¾¤çµ„è¨ˆç®—ï¼‰
     *    è¦å‰‡ï¼šåŒä¸€ shipGroup çš„å•†å“åˆè¨ˆæ•¸é‡ >= groupFreeQty â†’ è©²ç¾¤çµ„å…é‹
     *    groupFreeQty = å–è©²ç¾¤çµ„å…§å•†å“çš„ã€Œæœ€å°ã€freeQtyï¼ˆ>0ï¼‰ä½œç‚ºé–€æª»ï¼›è‹¥çš†ç‚º 0ï¼Œå‰‡ç„¡å…é‹
     *    é‹è²»æ”¶ä¸€æ¬¡ï¼Œä»¥è©²ç¾¤çµ„ä¸­ã€Œæœ€é«˜ã€shipFee ç‚ºä¸»ï¼ˆå¯ä¾éœ€æ±‚æ”¹ï¼‰
     * =========================================================== */
    function addToCart(pid, qty=1){
      const p = products.find(x=>x.id===pid);
      if(!p) return;
      const row = cart.get(pid) || { product:p, qty:0 };
      row.qty += qty;
      cart.set(pid, row);
      updateCartCount();
      openCart();
      renderCart();
    }

    function updateCartCount(){
      let totalQty = 0; cart.forEach(v=> totalQty += v.qty);
      document.getElementById('cartCount').textContent = totalQty;
    }

    function openCart(){ document.getElementById('drawer').classList.add('on') }
    function closeCart(){ document.getElementById('drawer').classList.remove('on') }

    function renderCart(){
      const list = document.getElementById('cartList');
      list.innerHTML = '';
      let sub = 0; let groups = {};
      cart.forEach(({product, qty})=>{
        sub += product.price * qty;
        const g = product.shipGroup;
        groups[g] ||= {qty:0, feeMax:0, freeCandidates:[], name:GROUP_LABELS[g]||g};
        groups[g].qty += qty;
        groups[g].feeMax = Math.max(groups[g].feeMax, Number(product.shipFee)||0);
        if(product.freeQty>0) groups[g].freeCandidates.push(product.freeQty);

        const item = document.createElement('div');
        item.className='item';
        item.innerHTML = `
          <div style="width:56px;height:56px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#f3f4f6;display:grid;place-items:center">${product.img?`<img src="${product.img}" style="width:100%;height:100%;object-fit:cover">`:'â€”'}</div>
          <div>
            <div style="font-weight:700">${product.name}</div>
            <div class="fine">${product.spec}</div>
            <div style="color:#b45309">$${fmt(product.price)}</div>
          </div>
          <div class="qty">
            <button onclick="decQty('${product.id}')">âˆ’</button>
            <div>${qty}</div>
            <button onclick="incQty('${product.id}')">ï¼‹</button>
          </div>`;
        list.appendChild(item);
      });

      const sum = document.getElementById('cartSummary');
      let ship = 0; let shipRows = '';
      Object.entries(groups).forEach(([key,g])=>{
        const groupFreeQty = g.freeCandidates.length? Math.min(...g.freeCandidates) : 0;
        const free = groupFreeQty>0 && g.qty >= groupFreeQty;
        const fee = free? 0 : g.feeMax;
        ship += fee;
        const need = Math.max(0, (groupFreeQty||0) - g.qty);
        const hint = groupFreeQty? (free? '<span class="ok">å·²é”å…é‹</span>' : `<span class="warn">å°šå·® ${need} ä»¶å…é‹</span>`) : '<em>æ­¤ç¾¤çµ„ç„¡å…é‹</em>';
        shipRows += `<div class="row"><div>${g.name} é‹è²»</div><div>$${fmt(fee)}ã€€${hint}</div></div>`;
      })
      const total = sub + ship;

      sum.innerHTML = `
        <div class="row"><div>å•†å“å°è¨ˆ</div><div>$${fmt(sub)}</div></div>
        ${shipRows || '<div class="row"><div>é‹è²»</div><div>$0</div></div>'}
        <div class="row" style="border-top:1px solid var(--border);padding-top:8px;font-weight:900"><div>æ‡‰ä»˜ç¸½é¡</div><div>$${fmt(total)}</div></div>
        <div class="fine">ï¼Šä¸åŒæº«å±¤åˆ†é–‹è¨ˆç®—é‹è²»èˆ‡å…é‹é–€æª»ï¼›å¯¦éš›å‡ºè²¨ä»¥åŒ¯æ¬¾æ ¸å¸³ç‚ºæº–ã€‚</div>`;
    }

    function incQty(pid){ const row = cart.get(pid); if(!row) return; row.qty++; cart.set(pid,row); updateCartCount(); renderCart(); }
    function decQty(pid){ const row = cart.get(pid); if(!row) return; row.qty--; if(row.qty<=0) cart.delete(pid); else cart.set(pid,row); updateCartCount(); renderCart(); }

    /* ===========================================================
     * 5) çµå¸³æµç¨‹ï¼ˆå…ˆå¡«è³‡æ–™â†’é€å‡ºåˆ° Google Apps Scriptï¼‰
     *    å°‡ GAS éƒ¨ç½²å¾Œçš„ç¶²å€å¡«å…¥ GAS_ENDPOINTã€‚
     *    è‹¥æœªè¨­å®šï¼Œæœƒä»¥ console.log æ¨¡æ“¬é€å‡ºã€‚
     * =========================================================== */
    const GAS_ENDPOINT = '';// ä¾‹ï¼š'https://script.google.com/macros/s/XXXX/exec'

    function goCheckout(){ if(cart.size===0){ alert('è«‹å…ˆåŠ å…¥å•†å“'); return } document.getElementById('sheet').classList.add('on') }
    function closeSheet(){ document.getElementById('sheet').classList.remove('on') }

    async function submitOrder(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      // æ•´ç†è³¼ç‰©è»Š
      let items = []; let sub=0; let ship=0; let groups={};
      cart.forEach(({product,qty})=>{
        items.push({id:product.id,name:product.name,spec:product.spec,price:product.price,qty,shipGroup:product.shipGroup});
        sub += product.price*qty;
        const g=product.shipGroup; groups[g] ||= {qty:0,fee:0,freeCandidates:[]};
        groups[g].qty += qty; groups[g].fee = Math.max(groups[g].fee, product.shipFee||0); if(product.freeQty>0) groups[g].freeCandidates.push(product.freeQty);
      });
      Object.values(groups).forEach(g=>{ const fq=g.freeCandidates.length?Math.min(...g.freeCandidates):0; ship += (fq>0 && g.qty>=fq)?0:g.fee; });
      const total = sub + ship;

      const payload = {
        type:'ORDER',
        buyer: fd.get('buyer'), phone: fd.get('phone'), email: fd.get('email'), line: fd.get('line'),
        recipient: fd.get('recipient'), address: fd.get('address'), ship_note: fd.get('ship_note'), memo: fd.get('memo'),
        items, sub, ship, total, ts: new Date().toISOString()
      };

      if(!GAS_ENDPOINT){
        console.log('DEV payload â†’', payload);
        alert('å·²æ¨¡æ“¬é€å‡ºè¨‚å–®ï¼ˆå°šæœªä¸²æ¥å¾Œç«¯ï¼‰ã€‚è«‹è¨­å®š Apps Script ç¶²å€å¾Œå³å¯æ­£å¼å¯«å…¥è©¦ç®—è¡¨ä¸¦å¯„ä¿¡ã€‚\nç¸½é¡ï¼š$'+fmt(total));
        closeSheet(); closeCart(); return;
      }

      try{
        const res = await fetch(GAS_ENDPOINT, {method:'POST', mode:'no-cors', body: JSON.stringify(payload)});
        alert('è¨‚å–®å·²é€å‡ºï¼è«‹ä¾åŒ¯æ¬¾è³‡è¨ŠåŒ¯æ¬¾ï¼Œæˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ã€‚');
        cart.clear(); updateCartCount(); closeSheet(); closeCart();
      }catch(err){
        console.error(err); alert('é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœã€‚')
      }
    }

    /* ===========================================================
     * 6) ç®¡ç†å“¡ï¼ˆæœ¬æ©Ÿï¼‰
     *    - ç™»å…¥ï¼šadmin / 111111
     *    - å¯æ”¹ LOGO/æ¨™é¡Œ/å°é¢æ–‡å­—èˆ‡ç”¢å“ JSONï¼ˆå„²å­˜æ–¼ localStorageï¼‰
     * =========================================================== */
    function toggleAdmin(){ document.getElementById('adminPane').classList.toggle('on'); document.getElementById('jsonBox').value = JSON.stringify(products,null,2) }
    function adminLogin(){
      const u = document.getElementById('adminUser').value || 'admin';
      const p = document.getElementById('adminPass').value || '111111';
      if(u==='admin' && p==='111111'){ alert('å·²ç™»å…¥ï¼ˆæœ¬æ©Ÿï¼‰'); }
      else{ alert('å¸³å¯†éŒ¯èª¤ï¼ˆé è¨­ admin / 111111ï¼‰'); }
    }
    function saveBrand(){
      const next = {
        logo: document.getElementById('inpLogo').value,
        title: document.getElementById('inpTitle').value,
        heroTitle: document.getElementById('inpHeroTitle').value,
        heroSub: document.getElementById('inpHeroSub').value,
      };
      localStorage.setItem(LS_KEY_BRAND, JSON.stringify(next));
      alert('å“ç‰Œæ–‡æ¡ˆå·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚é‡æ–°æ•´ç†å¾Œç”Ÿæ•ˆã€‚');
    }
    function saveProducts(){
      try{
        const obj = JSON.parse(document.getElementById('jsonBox').value||'[]');
        localStorage.setItem(LS_KEY_PRODUCTS, JSON.stringify(obj));
        alert('ç”¢å“ JSON å·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚é‡æ–°æ•´ç†é é¢ä»¥å¥—ç”¨ã€‚');
      }catch{ alert('JSON æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€—è™Ÿ / æ‹¬è™Ÿã€‚') }
    }

    // å•Ÿå‹•
    applyBrand();
    renderChips();
    renderGrid();
  </script>
</body>
</html>
