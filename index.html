<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"
  />
  <title>å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²</title>
  <meta
    name="description"
    content="å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²ï¼šA.ç²‰é¡ã€B.å†·è—åŸç‰©æ–™ã€C.å†·å‡åŸç‰©æ–™ã€‚æ•´ä»¶èˆ‡å–®å“é …ã€‚ä¸‹å–®å…ˆå¡«è³‡æ–™ã€å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ã€‚"
  />
  <style>
    :root {
      --bg: #faf7f2;
      --surface: #ffffff;
      --ink: #111827;
      --muted: #6b7280;
      --brand: #f59e0b;
      --brand-dark: #d97706;
      --ok: #16a34a;
      --bad: #ef4444;
      --border: #e5e7eb;
      --shadow: 0 12px 28px rgba(0, 0, 0, 0.06);
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; background: var(--bg); color: var(--ink); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif; }
    a { color: inherit; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 12px; }

    /* ===== Header ===== */
    header { position: sticky; top: 0; z-index: 60; background: rgba(255,255,255,.9); backdrop-filter: saturate(1.2) blur(10px); border-bottom: 1px solid var(--border); }
    .topbar { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 8px 0; }
    .brand { display: flex; align-items: center; gap: 8px; }
    .brand img { width: 38px; height: 38px; object-fit: contain; border-radius: 8px; border: 1px solid var(--border); background: #fff; }
    .brand h1 { font-size: 15px; margin: 0; font-weight: 800; letter-spacing: .2px; }
    nav { display: flex; gap: 8px; font-size: 13px; }
    nav a { padding: 6px 8px; border-radius: 9px; border: 1px solid transparent; }
    nav a:hover { border-color: var(--border); background: #fff; }

    /* ===== Hero ===== */
    .hero { position: relative; margin: 0 0 12px; background: linear-gradient(180deg,#fff,rgba(255,255,255,0)), url('https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?q=80&w=1600&auto=format&fit=crop'); background-size: cover; background-position: center; min-height: 42svh; border-bottom: 1px solid var(--border); }
    .hero::after { content: ""; position: absolute; inset: 0; background: linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,0) 55%); }
    .hero .hero-inner { position: relative; z-index: 1; display: grid; align-items: end; min-height: 42svh; }
    .hero .copy { padding: 22px 0 26px; color: #fff; }
    .hero .kicker { display: inline-block; background: rgba(0,0,0,.35); padding: 4px 8px; border: 1px solid rgba(255,255,255,.25); border-radius: 999px; font-size: 11px; margin-bottom: 8px; }
    .hero h2 { font-size: clamp(24px, 4.2vw, 42px); line-height: 1.15; margin: 0 0 6px; font-weight: 900; text-shadow: 0 2px 12px rgba(0,0,0,.22); }
    .hero p { margin: 0; font-size: clamp(13px, 2.3vw, 15px); opacity: .95; }
    .cta { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
    .btn { appearance: none; border: none; border-radius: 12px; padding: 10px 14px; font-weight: 700; cursor: pointer; }
    .btn.brand { background: var(--brand); color: #111; border: 1px solid var(--brand-dark); }
    .btn.ghost { background: rgba(255,255,255,.12); color: #fff; border: 1px solid rgba(255,255,255,.35); }

    /* ===== Chips (single row, scrollable) ===== */
    .chips { display: inline-flex; gap: 8px; padding: 10px 0 4px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
    .chips::-webkit-scrollbar { display: none; }
    .chip { padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px; background: #fff; font-size: 12px; cursor: pointer; }
    .chip.is-on { border-color: var(--brand); box-shadow: 0 2px 10px rgba(245,158,11,.25); }

    /* ===== Grid / Cards (mobile-first) ===== */
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
    @media (max-width: 360px) { .grid { grid-template-columns: 1fr; } }
    @media (min-width: 860px) { .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 14px; } }
    .card { position: relative; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); overflow: hidden; display: flex; flex-direction: column; }
    .card .media { aspect-ratio: 4 / 3; background: #f3f4f6; display: grid; place-items: center; overflow: hidden; }
    .card .media img { width: 100%; height: 100%; object-fit: cover; }
    .soldout { position: absolute; inset: auto 8px 8px auto; background: rgba(17,24,39,.85); color: #fff; padding: 4px 8px; border-radius: 10px; font-size: 11px; z-index: 2; }
    .badge { position: absolute; left: 8px; top: 8px; background: #fff; border: 1px solid var(--border); font-size: 11px; border-radius: 999px; padding: 3px 7px; }
    .body { padding: 10px; }
    .body h3 { margin: 0 0 2px; font-size: 15px; }
    .meta { color: var(--muted); font-size: 12px; }
    .price { margin-top: 6px; font-weight: 800; color: #b45309; }
    .btn.add { margin: 8px 0 2px; background: #111; color: #fff; border-radius: 12px; padding: 9px 12px; border: 1px solid #111; }
    .btn.add[disabled] { background: #cfcfcf; border-color: #cfcfcf; cursor: not-allowed; }
    .note { font-size: 11px; color: var(--muted); }

    /* ===== Floating Cart (orange icon) ===== */
    .cart-fab { position: fixed; right: 14px; bottom: 14px; z-index: 80; display: grid; place-items: center; width: 60px; height: 60px; border-radius: 50%; background: #ffedd5; border: 2px solid var(--brand-dark); box-shadow: 0 10px 24px rgba(0,0,0,.18); cursor: pointer; }
    .cart-fab svg { width: 34px; height: 34px; }
    .cart-count { position: absolute; right: -6px; top: -6px; background: #111; color: #fff; border-radius: 999px; min-width: 22px; height: 22px; display: grid; place-items: center; font-size: 12px; border: 2px solid #fff; }

    /* ===== Cart Drawer ===== */
    .drawer { position: fixed; inset: 0; z-index: 90; display: none; }
    .drawer.on { display: block; }
    .drawer .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.36); }
    .panel { position: absolute; right: 0; top: 0; bottom: 0; width: min(520px, 100%); background: #fff; box-shadow: -12px 0 28px rgba(0,0,0,.25); display: flex; flex-direction: column; }
    .panel header { padding: 12px; border-bottom: 1px solid var(--border); background: #fff; display: flex; align-items: center; justify-content: space-between; }
    .panel header h4 { margin: 0; font-size: 17px; }
    .list { flex: 1; overflow: auto; padding: 10px; }
    .item { display: grid; grid-template-columns: 56px 1fr auto; gap: 10px; align-items: center; border: 1px solid var(--border); border-radius: 12px; padding: 8px; margin-bottom: 8px; }
    .item-sub { font-size: 12px; color: var(--muted); }
    .qty { display: flex; align-items: center; gap: 6px; }
    .qty button { width: 28px; height: 28px; border: 1px solid var(--border); background: #fff; border-radius: 8px; cursor: pointer; }
    .summary { border-top: 1px dashed var(--border); padding: 10px; }
    .row { display: flex; justify-content: space-between; font-size: 14px; margin: 6px 0; }
    .row em { color: var(--muted); font-style: normal; }
    .row .ok { color: var(--ok); } .row .warn { color: #b45309; }
    .checkout { padding: 10px; border-top: 1px solid var(--border); }
    .btn.full { width: 100%; background: var(--brand); border: 1px solid var(--brand-dark); color: #111; font-weight: 900; }

    /* ===== Checkout (Step 2) ===== */
    .sheet { position: fixed; inset: 0; z-index: 95; display: none; }
    .sheet.on { display: block; }
    .sheet .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.36); }
    .sheet .card { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: min(720px, 96%); max-height: 90svh; overflow: auto; padding: 14px; border-radius: 16px; background: #fff; border: 1px solid var(--border); box-shadow: var(--shadow); }
    .form { display: grid; grid-template-columns: 1fr; gap: 8px; }
    .label { font-size: 12px; color: var(--muted); }
    .input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 10px; font: inherit; font-size: 16px; background: #fff; }
    .bank { margin: 4px 0 0; font-size: 13px; border: 1px dashed var(--border); border-radius: 12px; padding: 10px; background: #fffced; }
    .fine { font-size: 12px; color: var(--muted); }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    @media (max-width: 560px) { .two { grid-template-columns: 1fr; } }

    /* ===== Admin (local only) ===== */
    .admin-badge { position: fixed; left: 10px; bottom: 10px; z-index: 85; opacity: .7; }
    .admin-pane { position: fixed; left: 10px; bottom: 54px; background: #fff; border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow); padding: 10px; display: none; max-width: 92vw; }
    .admin-pane.on { display: block; }
    .admin-pane h5 { margin: 0 0 6px; }
    .admin-pane small { color: var(--muted); }
    .admin-pane textarea { width: min(72ch, 80vw); height: 160px; }

    /* ===== Footer ===== */
    footer { margin: 20px 0 90px; padding-top: 12px; border-top: 1px solid var(--border); font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <img id="logoImg" src="https://i.imgur.com/9Xx0m3H.png" alt="KenSu Logo" />
        <h1 id="siteTitle">å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²</h1>
      </div>
      <nav>
        <a href="#store">é¦¬ä¸Šé¸è³¼</a>
        <a href="#about">é—œæ–¼æˆ‘å€‘</a>
        <a href="#news">æœ€æ–°é®®å ±</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap hero-inner">
      <div class="copy">
        <span class="kicker" id="heroKicker">KenSu Wholesale</span>
        <h2 id="heroTitle">å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†</h2>
        <p id="heroSub">æ•´ä»¶èˆ‡å–®å“é …æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡ â€” å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨</p>
        <div class="cta">
          <button class="btn brand" onclick="scrollToStore()">ğŸ›’ é¦¬ä¸Šé¸è³¼</button>
          <button class="btn ghost" onclick="document.getElementById('about').scrollIntoView({behavior:'smooth'})">å“ç‰Œæ•…äº‹</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters / Chips -->
  <section class="wrap" id="store">
    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- About / News -->
  <section class="wrap" id="about" style="padding:18px 0 6px">
    <h3>é—œæ–¼æˆ‘å€‘</h3>
    <p>å•ƒé…¥å¾å¤œå¸‚å°æ”¤ç™¼è·¡ï¼Œä¸»æ‰“è±è§’é…¥ã€èŠ‹æ³¥é…¥ã€ç‚¸é®®å¥¶èˆ‡é£²å“åŸæ–™ã€‚ç‚ºäº†è®“éåŠ ç›Ÿå¤¥ä¼´ä¹Ÿèƒ½ç©©å®šå–å¾—åŸç‰©æ–™ï¼Œæˆ‘å€‘é–‹æ”¾<strong>æ•´ä»¶èˆ‡å–®å“é …</strong>æ‰¹ç™¼ã€‚å®Œæˆä¸‹å–®å¾Œï¼Œè«‹ä¾ç•«é¢é¡¯ç¤ºåŒ¯æ¬¾è³‡è¨Šå®ŒæˆåŒ¯æ¬¾ï¼›æˆ‘å€‘æ ¸å¸³å¾Œå®‰æ’å‡ºè²¨ã€‚</p>
  </section>
  <section class="wrap" id="news" style="padding:0 0 8px">
    <h3>æœ€æ–°é®®å ±</h3>
    <ul>
      <li>ğŸ§Š å†·è—/å†·å‡å“éœ€å…¨ç¨‹ä½æº«é…é€ï¼›ä¸åŒæº«å±¤æ•ç„¡æ³•åˆä½µå‡ºè²¨èˆ‡é‹è²»ã€‚</li>
      <li>ğŸšš å…é‹è¦å‰‡ï¼šä¾<strong>æº«å±¤ç¾¤çµ„</strong>è¨ˆç®—ï¼Œé”å„ç¾¤çµ„é–€æª»å³å…é‹ï¼ˆè¦å‰‡å¯«åœ¨ç”¢å“å¡ï¼‰ã€‚</li>
      <li>ğŸ“¦ å‡ºè²¨æ™‚ç¨‹ï¼šæ ¸å¸³å¾Œç´„ 3â€“5 å€‹å·¥ä½œå¤©ã€‚</li>
    </ul>
  </section>

  <!-- Floating Cart (Orange) -->
  <button class="cart-fab" id="cartFab" title="é–‹å•Ÿè³¼ç‰©è»Š" onclick="openCart()">
    <span class="cart-count" id="cartCount">0</span>
    <svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <circle cx="64" cy="64" r="36" fill="#f59e0b" stroke="#d97706" stroke-width="6" />
      <path d="M20 36h16l10 46h42l6-28H54" fill="none" stroke="#111" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="52" cy="96" r="6" fill="#111"/><circle cx="88" cy="96" r="6" fill="#111"/>
      <path d="M64 22c-10 0-18 8-18 18 10-6 20-6 36 0-2-10-10-18-18-18z" fill="#fed7aa" stroke="#d97706" stroke-width="4"/>
    </svg>
  </button>

  <!-- Cart Drawer -->
  <div class="drawer" id="drawer">
    <div class="backdrop" onclick="closeCart()"></div>
    <div class="panel">
      <header>
        <h4>è³¼ç‰©è»Š</h4>
        <button class="btn" onclick="closeCart()">é—œé–‰</button>
      </header>
      <div class="list" id="cartList"></div>
      <div class="summary" id="cartSummary"></div>
      <div class="checkout">
        <button class="btn full" onclick="goCheckout()">å‰å¾€çµå¸³ï¼ˆå…ˆå¡«è³‡æ–™å¾ŒåŒ¯æ¬¾ï¼‰</button>
      </div>
    </div>
  </div>

  <!-- Checkout Sheet -->
  <div class="sheet" id="sheet">
    <div class="backdrop" onclick="closeSheet()"></div>
    <div class="card">
      <h3 style="margin:6px 0 10px">å¡«å¯«å‡ºè²¨è³‡æ–™</h3>
      <form id="orderForm" class="form" onsubmit="submitOrder(event)">
        <div class="two">
          <div><div class="label">å…¬å¸/åº—åï¼ˆæˆ–å§“åï¼‰</div><input class="input" name="buyer" required></div>
          <div><div class="label">è¯çµ¡é›»è©±</div><input class="input" name="phone" required></div>
        </div>
        <div class="two">
          <div><div class="label">Emailï¼ˆæ”¶é€šçŸ¥ï¼‰</div><input class="input" name="email" type="email" required></div>
          <div><div class="label">LINE IDï¼ˆé¸å¡«ï¼‰</div><input class="input" name="line"></div>
        </div>
        <div class="two">
          <div><div class="label">æ”¶ä»¶äºº</div><input class="input" name="recipient" required></div>
          <div><div class="label">å‡ºè²¨æ–¹å¼</div>
            <select name="ship_note" class="input" required>
              <option value="å¸¸æº«é…é€">å¸¸æº«é…é€</option>
              <option value="å†·è—é…é€">å†·è—é…é€</option>
              <option value="å†·å‡é…é€">å†·å‡é…é€</option>
              <option value="è¶…å•†å–è²¨">è¶…å•†å–è²¨ï¼ˆé™å¯å¯„å“é …ï¼‰</option>
            </select>
          </div>
        </div>
        <div><div class="label">æ”¶ä»¶åœ°å€ / å–è²¨é–€å¸‚</div><input class="input" name="address" required></div>
        <div><div class="label">å‚™è¨»</div><textarea class="input" name="memo" rows="3" placeholder="å¦‚éœ€çµ±ç·¨æŠ¬é ­ã€æŒ‡å®šåˆ°è²¨æ—¥ã€é–‹ç®±éŒ„å½±ç­‰è«‹å¡«å¯«"></textarea></div>

        <div class="bank">
          <strong>åŒ¯æ¬¾è³‡è¨Šï¼š</strong>
          <div class="fine">æˆ¶åï¼šé…¥å‘³é¦™ä¼æ¥­ç¤¾ï½œéŠ€è¡Œï¼šXXXXï¼ˆä»£ç¢¼ 000ï¼‰ï½œå¸³è™Ÿï¼š0000000000000<br>å®Œæˆé€å‡ºå¾Œè«‹åŒ¯æ¬¾ï¼Œ<b>ç•™è¨€åŒ¯æ¬¾å¾Œäº”ç¢¼</b>ï¼›æˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„ 3â€“5 å€‹å·¥ä½œå¤©ï¼‰ã€‚</div>
        </div>
        <div class="fine">é€å‡ºå¾Œç³»çµ±æœƒå°‡è¨‚å–®å¯«å…¥ Google è©¦ç®—è¡¨ä¸¦å¯„é€ç¢ºèªä¿¡è‡³æ‚¨çš„ä¿¡ç®±ã€‚</div>
        <div class="two">
          <button type="button" class="btn" onclick="closeSheet()">å–æ¶ˆ</button>
          <button type="submit" class="btn brand">é€å‡ºè¨‚å–®ï¼ˆæœªä»˜æ¬¾ä¸å‡ºè²¨ï¼‰</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Admin (local quick edit) -->
  <button class="admin-badge btn" onclick="toggleAdmin()">ğŸ”’ ç®¡ç†å“¡</button>
  <div class="admin-pane" id="adminPane">
    <h5>å¿«é€Ÿè¨­å®šï¼ˆæœ¬æ©Ÿå„²å­˜ï¼‰</h5>
    <div class="fine">ç™»å…¥å¯†ç¢¼çµ±ä¸€ <b>111111</b>ï¼ˆåªé¡¯ç¤ºåœ¨æœ¬æ©Ÿï¼Œæœƒè¨˜éŒ„æ–¼è£ç½®ï¼‰ã€‚</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0">
      <input class="input" id="adminPass" type="password" placeholder="è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼" style="max-width:180px">
      <button class="btn" onclick="adminLogin()">ç™»å…¥</button>
      <button class="btn" onclick="saveBrand()">å„²å­˜å“ç‰Œæ–‡æ¡ˆ</button>
      <button class="btn" onclick="saveProducts()">å„²å­˜ç”¢å“ JSON</button>
    </div>
    <div class="two">
      <div>
        <div class="label">LOGO URLï¼ˆå¯è²¼ GitHub RAWï¼‰</div>
        <input class="input" id="inpLogo" placeholder="https://...png">
        <div class="label">ç¶²ç«™æ¨™é¡Œ</div>
        <input class="input" id="inpTitle" placeholder="å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²">
        <div class="label">å°é¢ä¸»æ¨™</div>
        <input class="input" id="inpHeroTitle" placeholder="å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†">
        <div class="label">å°é¢å‰¯æ¨™</div>
        <input class="input" id="inpHeroSub" placeholder="æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨">

        <div style="margin-top:10px">
          <div class="label">GitHub é€£çµ âœ RAW è½‰æ›å™¨ï¼ˆå½±ç‰‡/åœ–ç‰‡ï¼‰</div>
          <input class="input" id="ghUrl" placeholder="è²¼ä¸Š GitHub æª”æ¡ˆç¶²å€ï¼ˆå« blobï¼‰">
          <div class="two">
            <button class="btn" onclick="convertGh()">è½‰æ› RAW</button>
            <button class="btn" onclick="copyRaw()">è¤‡è£½ RAW é€£çµ</button>
          </div>
          <input class="input" id="ghRawOut" placeholder="è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡" readonly>
          <small class="fine">æ•™å­¸ï¼šæŠŠ <code>https://github.com/ç”¨æˆ¶/Repo/blob/åˆ†æ”¯/path/file.png</code> è½‰æˆ <code>https://raw.githubusercontent.com/ç”¨æˆ¶/Repo/åˆ†æ”¯/path/file.png</code>ï¼›æˆ–ç›´æ¥åœ¨åŸç¶²å€å¾Œé¢åŠ  <code>?raw=1</code>ã€‚</small>
        </div>
      </div>
      <div>
        <div class="label">ç”¢å“è³‡æ–™ï¼ˆJSONï¼šå¯æ”¹å”®åƒ¹ priceã€è¦æ ¼ specã€æ˜¯å¦å”®å®Œ soldOutã€å…é‹ freeQtyã€é‹è²» shipFeeï¼‰</div>
        <textarea id="jsonBox"></textarea>
      </div>
    </div>
    <small>ä¿®æ”¹å¾ŒæŒ‰ã€Œå„²å­˜ã€ï¼Œé‡æ–°æ•´ç†é é¢å³å¯çœ‹åˆ°è®Šæ›´ï¼ˆåªå½±éŸ¿æœ¬æ©Ÿï¼‰ã€‚</small>
  </div>

  <footer class="wrap">
    <div>é…¥å‘³é¦™ä¼æ¥­ç¤¾ï½œçµ±ç·¨ 93428964</div>
    <div>åœ°å€ï¼šå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿ</div>
    <div>é€£çµ¡é›»è©±ï¼š0933-721-978</div>
  </footer>

  <script>
    /* ===========================================================
     * 1) è³‡æ–™æ¨¡å‹ï¼ˆåªä¿ç•™å…­ç¨®åŸç‰©æ–™ï¼›å„ç•™ã€Œæ•´ä»¶ã€èˆ‡ã€Œå–®å“é …ã€ï¼‰
     *    æ¬„ä½ï¼šid, tag('A.ç²‰é¡'|'B.å†·è—åŸç‰©æ–™'|'C.å†·å‡åŸç‰©æ–™'), name, spec, price, type('æ•´ä»¶'|'å–®å“é …'),
     *         shipGroup('å¸¸æº«'|'å†·è—'|'å†·å‡'|'è¶…å•†'), shipFee, freeQty, minOrder, soldOut, img, note
     * =========================================================== */
    const DEFAULT_PRODUCTS = [
      // A.ç²‰é¡ï¼ˆå¸¸æº«ï¼‰â€” å•ƒé…¥å°ˆç”¨ç²‰
      {id:'powder_case', tag:'A.ç²‰é¡', name:'å•ƒé…¥å°ˆç”¨ç²‰', type:'æ•´ä»¶', spec:'4.5å…¬æ–¤ / 5åŒ… / 1ä»¶', price:4900, shipGroup:'å¸¸æº«', shipFee:150, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'powder_single', tag:'A.ç²‰é¡', name:'å•ƒé…¥å°ˆç”¨ç²‰', type:'å–®å“é …', spec:'4.5å…¬æ–¤ / 1åŒ…', price:980, shipGroup:'å¸¸æº«', shipFee:150, freeQty:2, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // B.å†·è—åŸç‰©æ–™ â€” å•ƒé…¥ä¹³é…ªä¸ï¼ˆå†·è—ï¼‰
      {id:'cheese_case', tag:'B.å†·è—åŸç‰©æ–™', name:'å•ƒé…¥ä¹³é…ªä¸', type:'æ•´ä»¶', spec:'1å…¬æ–¤ / 10åŒ… / 1ä»¶', price:3800, shipGroup:'å†·è—', shipFee:180, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'cheese_single', tag:'B.å†·è—åŸç‰©æ–™', name:'å•ƒé…¥ä¹³é…ªä¸', type:'å–®å“é …', spec:'1å…¬æ–¤ / 1åŒ…', price:380, shipGroup:'å†·è—', shipFee:180, freeQty:10, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥è±è§’ä»ï¼ˆå†·å‡ï¼‰
      {id:'waterchest_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥è±è§’ä»', type:'æ•´ä»¶', spec:'3å…¬æ–¤ / 4åŒ… / 1ä»¶', price:2400, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'waterchest_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥è±è§’ä»', type:'å–®å“é …', spec:'3å…¬æ–¤ / 1åŒ…', price:600, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥èŠ‹æ³¥ä¸ï¼ˆå†·å‡ï¼‰
      {id:'taro_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥èŠ‹æ³¥ä¸', type:'æ•´ä»¶', spec:'750å…¬å…‹ / 18ç›’ / 1ä»¶', price:4960, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'taro_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥èŠ‹æ³¥ä¸', type:'å–®å“é …', spec:'750å…¬å…‹ / 1ç›’', price:276, shipGroup:'å†·å‡', shipFee:200, freeQty:18, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥ç‚¸é®®å¥¶ï¼ˆå†·å‡ï¼‰
      {id:'milkfried_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‚¸é®®å¥¶', type:'æ•´ä»¶', spec:'6æ¢ / 16ç›’ / 1ä»¶', price:1696, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'milkfried_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‚¸é®®å¥¶', type:'å–®å“é …', spec:'6æ¢ / 1ç›’', price:106, shipGroup:'å†·å‡', shipFee:200, freeQty:32, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥ç‰¹èª¿ç‰›å¥¶ï¼ˆå†·å‡ï¼‰
      {id:'milkmix_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', type:'æ•´ä»¶', spec:'330æ¯«å‡ / 10ç“¶ / 1ä»¶', price:750, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'milkmix_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', type:'å–®å“é …', spec:'330æ¯«å‡ / 1ç“¶', price:75, shipGroup:'å†·å‡', shipFee:200, freeQty:10, minOrder:1, soldOut:false, img:'', note:'â€”'}
    ];

    // åƒ…ä¿ç•™æŒ‡å®šæ¨™ç±¤èˆ‡æº«å±¤
    const TAGS = ['A.ç²‰é¡', 'B.å†·è—åŸç‰©æ–™', 'C.å†·å‡åŸç‰©æ–™', 'å¸¸æº«', 'å†·è—', 'å†·å‡'];
    const GROUP_LABELS = { å¸¸æº«: 'å¸¸æº«', å†·è—: 'å†·è—', å†·å‡: 'å†·å‡' };

    /* ===========================================================
     * 2) ç‹€æ…‹èˆ‡å„²å­˜
     * =========================================================== */
    const LS_KEY_PRODUCTS = 'kensu_wholesale_products_v2';
    const LS_KEY_BRAND = 'kensu_wholesale_brand_v2';
    const LS_KEY_ADMIN = 'kensu_admin_ok_v1';

    const brand = loadBrand();
    const products = loadProducts();
    let filterOn = 'å…¨éƒ¨';
    const cart = new Map(); // id -> { product, qty }

    function loadProducts() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_PRODUCTS)) || DEFAULT_PRODUCTS; } catch { return DEFAULT_PRODUCTS; }
    }
    function loadBrand() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_BRAND)) || { logo:'', title:'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨' }; } catch { return { logo:'', title:'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨' }; }
    }

    /* ===========================================================
     * 3) åˆå§‹åŒ–ï¼šå“ç‰Œæ–‡æ¡ˆ + ç¯©é¸ + å¡ç‰‡æ¸²æŸ“
     * =========================================================== */
    function applyBrand(){
      if (brand.logo) document.getElementById('logoImg').src = brand.logo;
      document.getElementById('siteTitle').textContent = brand.title || 'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²';
      document.getElementById('heroTitle').textContent = brand.heroTitle || '';
      document.getElementById('heroSub').textContent = brand.heroSub || '';
      // ç®¡ç†é¢æ¿é å¡«
      document.getElementById('inpLogo').value = brand.logo || '';
      document.getElementById('inpTitle').value = brand.title || '';
      document.getElementById('inpHeroTitle').value = brand.heroTitle || '';
      document.getElementById('inpHeroSub').value = brand.heroSub || '';
    }

    function uniqueTags(){
      // å›ºå®šç‚ºéœ€æ±‚æŒ‡å®šçš„æ¨™ç±¤ï¼ˆå«ã€Œå…¨éƒ¨ã€åœ¨ chips å…§ç¬¬ä¸€å€‹ï¼‰
      return ['å…¨éƒ¨', ...TAGS];
    }

    function renderChips(){
      const chips = document.getElementById('chips');
      chips.innerHTML = '';
      uniqueTags().forEach(t => {
        const btn = document.createElement('button');
        btn.className = 'chip' + (t === filterOn ? ' is-on' : '');
        btn.textContent = t;
        btn.onclick = () => { filterOn = t; renderGrid(); };
        chips.appendChild(btn);
      });
    }

    function matchFilter(p){
      if (filterOn === 'å…¨éƒ¨') return true;
      if (['å¸¸æº«','å†·è—','å†·å‡'].includes(filterOn)) return GROUP_LABELS[p.shipGroup] === filterOn;
      return p.tag === filterOn;
    }

    function renderGrid(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      products.filter(matchFilter).forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        const title = `${p.name}ï¼ˆ${p.type}ï¼‰`;
        card.innerHTML = `
          <div class="media">
            ${p.img ? `<img src="${p.img}" alt="${title}">` : `<span style="color:#9ca3af">(å°šæœªä¸Šå‚³åœ–ç‰‡)</span>`}
            <span class="badge">${p.tag}ï½œ${GROUP_LABELS[p.shipGroup] || p.shipGroup}</span>
            ${p.soldOut ? `<span class="soldout">å·²å”®å®Œ</span>` : ''}
          </div>
          <div class="body">
            <h3>${title}</h3>
            <div class="meta">${p.spec}</div>
            <div class="price">$${fmt(p.price)}</div>
            <button class="btn add" ${p.soldOut || p.minOrder===0 ? 'disabled' : ''} onclick="addToCart('${p.id}', ${p.minOrder || 1})">åŠ å…¥è³¼ç‰©è»Š</button>
            <div class="note">é‹è²» $${p.shipFee}${p.freeQty>0?`ãƒ»æ»¿${p.freeQty}ä»¶å…é‹`:''}${p.note?`ï½œ${p.note}`:''}</div>
          </div>`;
        grid.appendChild(card);
      });
    }

    function fmt(n){ return Number(n).toLocaleString('zh-TW'); }
    function scrollToStore(){ document.getElementById('store').scrollIntoView({ behavior:'smooth' }); }

    /* ===========================================================
     * 4) è³¼ç‰©è»Šï¼šåŠ å…¥ / æ¸²æŸ“ / é‹è²»è¨ˆç®—
     *    éœ€æ±‚ï¼šåŠ å…¥å•†å“æ™‚ã€Œä¸è·³è½‰è³¼ç‰©è»Šé ã€â†’ åƒ…é¡¯ç¤ºæç¤ºï¼Œæ•¸é‡åªå…è¨± +/-
     * =========================================================== */
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = 'position:fixed;left:50%;bottom:90px;transform:translateX(-50%);background:#111;color:#fff;padding:8px 12px;border-radius:10px;font-size:13px;opacity:.96;z-index:120';
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 1500);
    }

    function addToCart(pid, qty=1){
      const p = products.find(x => x.id === pid);
      if(!p) return;
      const row = cart.get(pid) || { product: p, qty: 0 };
      row.qty += qty;
      cart.set(pid, row);
      updateCartCount();
      renderCart();
      toast('å·²åŠ å…¥è³¼ç‰©è»Š'); // ä¸è‡ªå‹•æ‰“é–‹è³¼ç‰©è»Š
    }

    function updateCartCount(){
      let totalQty = 0; cart.forEach(v => totalQty += v.qty);
      document.getElementById('cartCount').textContent = totalQty;
    }

    function openCart(){ document.getElementById('drawer').classList.add('on'); }
    function closeCart(){ document.getElementById('drawer').classList.remove('on'); }

    function renderCart(){
      const list = document.getElementById('cartList');
      list.innerHTML = '';
      let sub = 0; let groups = {};
      cart.forEach(({product, qty}) => {
        sub += product.price * qty;
        const g = product.shipGroup;
        groups[g] ||= { qty: 0, feeMax: 0, freeCandidates: [], name: GROUP_LABELS[g] || g };
        groups[g].qty += qty;
        groups[g].feeMax = Math.max(groups[g].feeMax, Number(product.shipFee) || 0);
        if(product.freeQty > 0) groups[g].freeCandidates.push(product.freeQty);

        const item = document.createElement('div');
        item.className = 'item';
        const subLine = product.price * qty;
        item.innerHTML = `
          <div style="width:56px;height:56px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#f3f4f6;display:grid;place-items:center">${product.img?`<img src="${product.img}" style="width:100%;height:100%;object-fit:cover">`:'â€”'}</div>
          <div>
            <div style="font-weight:700">${product.name}ï¼ˆ${product.type}ï¼‰</div>
            <div class="item-sub">${product.spec}ï½œå–®åƒ¹ $${fmt(product.price)}ï½œå°è¨ˆ $${fmt(subLine)}ï½œ${GROUP_LABELS[product.shipGroup]||product.shipGroup}</div>
          </div>
          <div class="qty">
            <button onclick="decQty('${product.id}')">âˆ’</button>
            <div>${qty}</div>
            <button onclick="incQty('${product.id}')">ï¼‹</button>
          </div>`;
        list.appendChild(item);
      });

      const sum = document.getElementById('cartSummary');
      let ship = 0; let shipRows = '';
      Object.entries(groups).forEach(([key, g]) => {
        const groupFreeQty = g.freeCandidates.length ? Math.min(...g.freeCandidates) : 0;
        const free = groupFreeQty>0 && g.qty >= groupFreeQty;
        const fee = free ? 0 : g.feeMax;
        ship += fee;
        const need = Math.max(0, (groupFreeQty||0) - g.qty);
        const hint = groupFreeQty ? (free ? '<span class="ok">å·²é”å…é‹</span>' : `<span class="warn">å°šå·® ${need} ä»¶å…é‹</span>`) : '<em>æ­¤ç¾¤çµ„ç„¡å…é‹</em>';
        shipRows += `<div class="row"><div>${g.name} é‹è²»</div><div>$${fmt(fee)}ã€€${hint}</div></div>`;
      });
      const total = sub + ship;

      // æ˜ç´°ï¼šç¸½ä»¶æ•¸ã€ç¾¤çµ„ä»¶æ•¸
      let totalQty = 0; cart.forEach(v => totalQty += v.qty);
      let groupDetail = Object.entries(groups).map(([k,g])=>`${g.name}:${g.qty}ä»¶`).join('ã€');

      sum.innerHTML = `
        <div class="row"><div>å•†å“å°è¨ˆ</div><div>$${fmt(sub)}</div></div>
        <div class="row"><div>ä»¶æ•¸æ˜ç´°</div><div>${totalQty} ä»¶ï¼ˆ${groupDetail||'â€”'}ï¼‰</div></div>
        ${shipRows || '<div class="row"><div>é‹è²»</div><div>$0</div></div>'}
        <div class="row" style="border-top:1px solid var(--border);padding-top:8px;font-weight:900"><div>æ‡‰ä»˜ç¸½é¡</div><div>$${fmt(total)}</div></div>
        <div class="fine">ï¼Šä¸åŒæº«å±¤åˆ†é–‹è¨ˆç®—é‹è²»èˆ‡å…é‹é–€æª»ï¼›å¯¦éš›å‡ºè²¨ä»¥åŒ¯æ¬¾æ ¸å¸³ç‚ºæº–ã€‚</div>`;
    }

    function incQty(pid){ const row = cart.get(pid); if(!row) return; row.qty++; cart.set(pid,row); updateCartCount(); renderCart(); }
    function decQty(pid){ const row = cart.get(pid); if(!row) return; row.qty--; if(row.qty<=0) cart.delete(pid); else cart.set(pid,row); updateCartCount(); renderCart(); }

    /* ===========================================================
     * 5) çµå¸³æµç¨‹ï¼ˆå…ˆå¡«è³‡æ–™â†’é€å‡ºåˆ° Google Apps Scriptï¼‰
     * =========================================================== */
    const GAS_ENDPOINT = '';// éƒ¨ç½²å¾Œè²¼ä¸Š Web App URL

    function goCheckout(){ if(cart.size===0){ alert('è«‹å…ˆåŠ å…¥å•†å“'); return } document.getElementById('sheet').classList.add('on'); }
    function closeSheet(){ document.getElementById('sheet').classList.remove('on'); }

    async function submitOrder(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      // æ•´ç†è³¼ç‰©è»Š
      let items = []; let sub=0; let ship=0; let groups={};
      cart.forEach(({product,qty})=>{
        items.push({id:product.id,name:product.name,type:product.type,spec:product.spec,price:product.price,qty,shipGroup:product.shipGroup});
        sub += product.price*qty;
        const g=product.shipGroup; groups[g] ||= {qty:0,fee:0,freeCandidates:[]};
        groups[g].qty += qty; groups[g].fee = Math.max(groups[g].fee, product.shipFee||0); if(product.freeQty>0) groups[g].freeCandidates.push(product.freeQty);
      });
      Object.values(groups).forEach(g=>{ const fq=g.freeCandidates.length?Math.min(...g.freeCandidates):0; ship += (fq>0 && g.qty>=fq)?0:g.fee; });
      const total = sub + ship;

      const payload = {
        type:'ORDER',
        buyer: fd.get('buyer'), phone: fd.get('phone'), email: fd.get('email'), line: fd.get('line'),
        recipient: fd.get('recipient'), address: fd.get('address'), ship_note: fd.get('ship_note'), memo: fd.get('memo'),
        items, sub, ship, total, ts: new Date().toISOString()
      };

      if(!GAS_ENDPOINT){
        console.log('DEV payload â†’', payload);
        alert('å·²æ¨¡æ“¬é€å‡ºè¨‚å–®ï¼ˆå°šæœªä¸²æ¥å¾Œç«¯ï¼‰ã€‚è«‹è¨­å®š Apps Script ç¶²å€å¾Œå³å¯æ­£å¼å¯«å…¥è©¦ç®—è¡¨ä¸¦å¯„ä¿¡ã€‚
ç¸½é¡ï¼š$'+fmt(total));
        closeSheet(); closeCart(); return;
      }

      try{
        await fetch(GAS_ENDPOINT, {method:'POST', mode:'no-cors', body: JSON.stringify(payload)});
        alert('è¨‚å–®å·²é€å‡ºï¼è«‹ä¾åŒ¯æ¬¾è³‡è¨ŠåŒ¯æ¬¾ï¼Œæˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ã€‚');
        cart.clear(); updateCartCount(); closeSheet(); closeCart();
      }catch(err){ console.error(err); alert('é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœã€‚'); }
    }

    /* ===========================================================
     * 6) ç®¡ç†å“¡ï¼ˆæœ¬æ©Ÿï¼‰ï¼šå¯†ç¢¼ 111111ï¼ˆä¸é¡¯ç¤ºåœ¨ç•«é¢ï¼›åƒ…æœ¬æ©Ÿå­˜è¨˜éŒ„ï¼‰
     * =========================================================== */
    function toggleAdmin(){
      const pane = document.getElementById('adminPane');
      pane.classList.toggle('on');
      document.getElementById('jsonBox').value = JSON.stringify(products, null, 2);
    }
    function adminLogin(){
      const ok = localStorage.getItem(LS_KEY_ADMIN) === 'YES';
      const pass = document.getElementById('adminPass').value;
      if(ok || pass === '111111'){
        localStorage.setItem(LS_KEY_ADMIN,'YES');
        alert('å·²ç™»å…¥ï¼ˆæœ¬æ©Ÿï¼‰');
      }else{ alert('å¯†ç¢¼éŒ¯èª¤'); }
    }
    function saveBrand(){
      if(localStorage.getItem(LS_KEY_ADMIN) !== 'YES'){ alert('è«‹å…ˆç™»å…¥ç®¡ç†å“¡'); return; }
      const next = {
        logo: document.getElementById('inpLogo').value,
        title: document.getElementById('inpTitle').value,
        heroTitle: document.getElementById('inpHeroTitle').value,
        heroSub: document.getElementById('inpHeroSub').value,
      };
      localStorage.setItem(LS_KEY_BRAND, JSON.stringify(next));
      applyBrand();
      alert('å“ç‰Œæ–‡æ¡ˆå·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚');
    }
    function saveProducts(){
      if(localStorage.getItem(LS_KEY_ADMIN) !== 'YES'){ alert('è«‹å…ˆç™»å…¥ç®¡ç†å“¡'); return; }
      try{
        const obj = JSON.parse(document.getElementById('jsonBox').value||'[]');
        localStorage.setItem(LS_KEY_PRODUCTS, JSON.stringify(obj));
        alert('ç”¢å“ JSON å·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚é‡æ–°æ•´ç†é é¢ä»¥å¥—ç”¨ã€‚');
      }catch{ alert('JSON æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€—è™Ÿ / æ‹¬è™Ÿã€‚') }
    }

    // GitHub âœ RAW è½‰æ›
    function githubToRaw(url){
      try{
        const u = new URL(url);
        if(u.hostname === 'github.com'){
          // /user/repo/blob/branch/path -> raw.githubusercontent.com/user/repo/branch/path
          const parts = u.pathname.split('/').filter(Boolean);
          const idx = parts.indexOf('blob');
          if(idx>0){
            const user = parts[0], repo = parts[1];
            const branch = parts[3];
            const rest = parts.slice(4).join('/');
            return `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${rest}`;
          }
        }
        // fallback: åŠ  ?raw=1
        if(!url.includes('?')) return url + '?raw=1';
        return url + '&raw=1';
      }catch{ return url }
    }
    function convertGh(){ const url = document.getElementById('ghUrl').value.trim(); document.getElementById('ghRawOut').value = githubToRaw(url); }
    function copyRaw(){ const o=document.getElementById('ghRawOut'); o.select(); document.execCommand('copy'); alert('å·²è¤‡è£½ RAW é€£çµ'); }

    // å•Ÿå‹•
    applyBrand();
    renderChips();
    renderGrid();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"
  />
  <title>å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²</title>
  <meta
    name="description"
    content="å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²ï¼šA.ç²‰é¡ã€B.å†·è—åŸç‰©æ–™ã€C.å†·å‡åŸç‰©æ–™ã€‚æ•´ä»¶èˆ‡å–®å“é …ã€‚ä¸‹å–®å…ˆå¡«è³‡æ–™ã€å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨ã€‚"
  />
  <style>
    :root {
      --bg: #faf7f2;
      --surface: #ffffff;
      --ink: #111827;
      --muted: #6b7280;
      --brand: #f59e0b;
      --brand-dark: #d97706;
      --ok: #16a34a;
      --bad: #ef4444;
      --border: #e5e7eb;
      --shadow: 0 12px 28px rgba(0, 0, 0, 0.06);
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; background: var(--bg); color: var(--ink); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif; }
    a { color: inherit; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 12px; }

    /* ===== Header ===== */
    header { position: sticky; top: 0; z-index: 60; background: rgba(255,255,255,.9); backdrop-filter: saturate(1.2) blur(10px); border-bottom: 1px solid var(--border); }
    .topbar { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 8px 0; }
    .brand { display: flex; align-items: center; gap: 8px; }
    .brand img { width: 38px; height: 38px; object-fit: contain; border-radius: 8px; border: 1px solid var(--border); background: #fff; }
    .brand h1 { font-size: 15px; margin: 0; font-weight: 800; letter-spacing: .2px; }
    nav { display: flex; gap: 8px; font-size: 13px; }
    nav a { padding: 6px 8px; border-radius: 9px; border: 1px solid transparent; }
    nav a:hover { border-color: var(--border); background: #fff; }

    /* ===== Hero ===== */
    .hero { position: relative; margin: 0 0 12px; background: linear-gradient(180deg,#fff,rgba(255,255,255,0)), url('https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?q=80&w=1600&auto=format&fit=crop'); background-size: cover; background-position: center; min-height: 42svh; border-bottom: 1px solid var(--border); }
    .hero::after { content: ""; position: absolute; inset: 0; background: linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,0) 55%); }
    .hero .hero-inner { position: relative; z-index: 1; display: grid; align-items: end; min-height: 42svh; }
    .hero .copy { padding: 22px 0 26px; color: #fff; }
    .hero .kicker { display: inline-block; background: rgba(0,0,0,.35); padding: 4px 8px; border: 1px solid rgba(255,255,255,.25); border-radius: 999px; font-size: 11px; margin-bottom: 8px; }
    .hero h2 { font-size: clamp(24px, 4.2vw, 42px); line-height: 1.15; margin: 0 0 6px; font-weight: 900; text-shadow: 0 2px 12px rgba(0,0,0,.22); }
    .hero p { margin: 0; font-size: clamp(13px, 2.3vw, 15px); opacity: .95; }
    .cta { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
    .btn { appearance: none; border: none; border-radius: 12px; padding: 10px 14px; font-weight: 700; cursor: pointer; }
    .btn.brand { background: var(--brand); color: #111; border: 1px solid var(--brand-dark); }
    .btn.ghost { background: rgba(255,255,255,.12); color: #fff; border: 1px solid rgba(255,255,255,.35); }

    /* ===== Chips (single row, scrollable) ===== */
    .chips { display: inline-flex; gap: 8px; padding: 10px 0 4px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
    .chips::-webkit-scrollbar { display: none; }
    .chip { padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px; background: #fff; font-size: 12px; cursor: pointer; }
    .chip.is-on { border-color: var(--brand); box-shadow: 0 2px 10px rgba(245,158,11,.25); }

    /* ===== Grid / Cards (mobile-first) ===== */
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
    @media (max-width: 360px) { .grid { grid-template-columns: 1fr; } }
    @media (min-width: 860px) { .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 14px; } }
    .card { position: relative; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); overflow: hidden; display: flex; flex-direction: column; }
    .card .media { aspect-ratio: 4 / 3; background: #f3f4f6; display: grid; place-items: center; overflow: hidden; }
    .card .media img { width: 100%; height: 100%; object-fit: cover; }
    .soldout { position: absolute; inset: auto 8px 8px auto; background: rgba(17,24,39,.85); color: #fff; padding: 4px 8px; border-radius: 10px; font-size: 11px; z-index: 2; }
    .badge { position: absolute; left: 8px; top: 8px; background: #fff; border: 1px solid var(--border); font-size: 11px; border-radius: 999px; padding: 3px 7px; }
    .body { padding: 10px; }
    .body h3 { margin: 0 0 2px; font-size: 15px; }
    .meta { color: var(--muted); font-size: 12px; }
    .price { margin-top: 6px; font-weight: 800; color: #b45309; }
    .btn.add { margin: 8px 0 2px; background: #111; color: #fff; border-radius: 12px; padding: 9px 12px; border: 1px solid #111; }
    .btn.add[disabled] { background: #cfcfcf; border-color: #cfcfcf; cursor: not-allowed; }
    .note { font-size: 11px; color: var(--muted); }

    /* ===== Floating Cart (orange icon) ===== */
    .cart-fab { position: fixed; right: 14px; bottom: 14px; z-index: 80; display: grid; place-items: center; width: 60px; height: 60px; border-radius: 50%; background: #ffedd5; border: 2px solid var(--brand-dark); box-shadow: 0 10px 24px rgba(0,0,0,.18); cursor: pointer; }
    .cart-fab svg { width: 34px; height: 34px; }
    .cart-count { position: absolute; right: -6px; top: -6px; background: #111; color: #fff; border-radius: 999px; min-width: 22px; height: 22px; display: grid; place-items: center; font-size: 12px; border: 2px solid #fff; }

    /* ===== Cart Drawer ===== */
    .drawer { position: fixed; inset: 0; z-index: 90; display: none; }
    .drawer.on { display: block; }
    .drawer .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.36); }
    .panel { position: absolute; right: 0; top: 0; bottom: 0; width: min(520px, 100%); background: #fff; box-shadow: -12px 0 28px rgba(0,0,0,.25); display: flex; flex-direction: column; }
    .panel header { padding: 12px; border-bottom: 1px solid var(--border); background: #fff; display: flex; align-items: center; justify-content: space-between; }
    .panel header h4 { margin: 0; font-size: 17px; }
    .list { flex: 1; overflow: auto; padding: 10px; }
    .item { display: grid; grid-template-columns: 56px 1fr auto; gap: 10px; align-items: center; border: 1px solid var(--border); border-radius: 12px; padding: 8px; margin-bottom: 8px; }
    .item-sub { font-size: 12px; color: var(--muted); }
    .qty { display: flex; align-items: center; gap: 6px; }
    .qty button { width: 28px; height: 28px; border: 1px solid var(--border); background: #fff; border-radius: 8px; cursor: pointer; }
    .summary { border-top: 1px dashed var(--border); padding: 10px; }
    .row { display: flex; justify-content: space-between; font-size: 14px; margin: 6px 0; }
    .row em { color: var(--muted); font-style: normal; }
    .row .ok { color: var(--ok); } .row .warn { color: #b45309; }
    .checkout { padding: 10px; border-top: 1px solid var(--border); }
    .btn.full { width: 100%; background: var(--brand); border: 1px solid var(--brand-dark); color: #111; font-weight: 900; }

    /* ===== Checkout (Step 2) ===== */
    .sheet { position: fixed; inset: 0; z-index: 95; display: none; }
    .sheet.on { display: block; }
    .sheet .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.36); }
    .sheet .card { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: min(720px, 96%); max-height: 90svh; overflow: auto; padding: 14px; border-radius: 16px; background: #fff; border: 1px solid var(--border); box-shadow: var(--shadow); }
    .form { display: grid; grid-template-columns: 1fr; gap: 8px; }
    .label { font-size: 12px; color: var(--muted); }
    .input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 10px; font: inherit; font-size: 16px; background: #fff; }
    .bank { margin: 4px 0 0; font-size: 13px; border: 1px dashed var(--border); border-radius: 12px; padding: 10px; background: #fffced; }
    .fine { font-size: 12px; color: var(--muted); }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    @media (max-width: 560px) { .two { grid-template-columns: 1fr; } }

    /* ===== Admin (local only) ===== */
    .admin-badge { position: fixed; left: 10px; bottom: 10px; z-index: 85; opacity: .7; }
    .admin-pane { position: fixed; left: 10px; bottom: 54px; background: #fff; border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow); padding: 10px; display: none; max-width: 92vw; }
    .admin-pane.on { display: block; }
    .admin-pane h5 { margin: 0 0 6px; }
    .admin-pane small { color: var(--muted); }
    .admin-pane textarea { width: min(72ch, 80vw); height: 160px; }

    /* ===== Footer ===== */
    footer { margin: 20px 0 90px; padding-top: 12px; border-top: 1px solid var(--border); font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <img id="logoImg" src="https://i.imgur.com/9Xx0m3H.png" alt="KenSu Logo" />
        <h1 id="siteTitle">å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²</h1>
      </div>
      <nav>
        <a href="#store">é¦¬ä¸Šé¸è³¼</a>
        <a href="#about">é—œæ–¼æˆ‘å€‘</a>
        <a href="#news">æœ€æ–°é®®å ±</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap hero-inner">
      <div class="copy">
        <span class="kicker" id="heroKicker">KenSu Wholesale</span>
        <h2 id="heroTitle">å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†</h2>
        <p id="heroSub">æ•´ä»¶èˆ‡å–®å“é …æ‰¹ç™¼ï½œå¸¸æº«ãƒ»å†·è—ãƒ»å†·å‡ â€” å…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨</p>
        <div class="cta">
          <button class="btn brand" onclick="scrollToStore()">ğŸ›’ é¦¬ä¸Šé¸è³¼</button>
          <button class="btn ghost" onclick="document.getElementById('about').scrollIntoView({behavior:'smooth'})">å“ç‰Œæ•…äº‹</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters / Chips -->
  <section class="wrap" id="store">
    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- About / News -->
  <section class="wrap" id="about" style="padding:18px 0 6px">
    <h3>é—œæ–¼æˆ‘å€‘</h3>
    <p>å•ƒé…¥å¾å¤œå¸‚å°æ”¤ç™¼è·¡ï¼Œä¸»æ‰“è±è§’é…¥ã€èŠ‹æ³¥é…¥ã€ç‚¸é®®å¥¶èˆ‡é£²å“åŸæ–™ã€‚ç‚ºäº†è®“éåŠ ç›Ÿå¤¥ä¼´ä¹Ÿèƒ½ç©©å®šå–å¾—åŸç‰©æ–™ï¼Œæˆ‘å€‘é–‹æ”¾<strong>æ•´ä»¶èˆ‡å–®å“é …</strong>æ‰¹ç™¼ã€‚å®Œæˆä¸‹å–®å¾Œï¼Œè«‹ä¾ç•«é¢é¡¯ç¤ºåŒ¯æ¬¾è³‡è¨Šå®ŒæˆåŒ¯æ¬¾ï¼›æˆ‘å€‘æ ¸å¸³å¾Œå®‰æ’å‡ºè²¨ã€‚</p>
  </section>
  <section class="wrap" id="news" style="padding:0 0 8px">
    <h3>æœ€æ–°é®®å ±</h3>
    <ul>
      <li>ğŸ§Š å†·è—/å†·å‡å“éœ€å…¨ç¨‹ä½æº«é…é€ï¼›ä¸åŒæº«å±¤æ•ç„¡æ³•åˆä½µå‡ºè²¨èˆ‡é‹è²»ã€‚</li>
      <li>ğŸšš å…é‹è¦å‰‡ï¼šä¾<strong>æº«å±¤ç¾¤çµ„</strong>è¨ˆç®—ï¼Œé”å„ç¾¤çµ„é–€æª»å³å…é‹ï¼ˆè¦å‰‡å¯«åœ¨ç”¢å“å¡ï¼‰ã€‚</li>
      <li>ğŸ“¦ å‡ºè²¨æ™‚ç¨‹ï¼šæ ¸å¸³å¾Œç´„ 3â€“5 å€‹å·¥ä½œå¤©ã€‚</li>
    </ul>
  </section>

  <!-- Floating Cart (Orange) -->
  <button class="cart-fab" id="cartFab" title="é–‹å•Ÿè³¼ç‰©è»Š" onclick="openCart()">
    <span class="cart-count" id="cartCount">0</span>
    <svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <circle cx="64" cy="64" r="36" fill="#f59e0b" stroke="#d97706" stroke-width="6" />
      <path d="M20 36h16l10 46h42l6-28H54" fill="none" stroke="#111" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="52" cy="96" r="6" fill="#111"/><circle cx="88" cy="96" r="6" fill="#111"/>
      <path d="M64 22c-10 0-18 8-18 18 10-6 20-6 36 0-2-10-10-18-18-18z" fill="#fed7aa" stroke="#d97706" stroke-width="4"/>
    </svg>
  </button>

  <!-- Cart Drawer -->
  <div class="drawer" id="drawer">
    <div class="backdrop" onclick="closeCart()"></div>
    <div class="panel">
      <header>
        <h4>è³¼ç‰©è»Š</h4>
        <button class="btn" onclick="closeCart()">é—œé–‰</button>
      </header>
      <div class="list" id="cartList"></div>
      <div class="summary" id="cartSummary"></div>
      <div class="checkout">
        <button class="btn full" onclick="goCheckout()">å‰å¾€çµå¸³ï¼ˆå…ˆå¡«è³‡æ–™å¾ŒåŒ¯æ¬¾ï¼‰</button>
      </div>
    </div>
  </div>

  <!-- Checkout Sheet -->
  <div class="sheet" id="sheet">
    <div class="backdrop" onclick="closeSheet()"></div>
    <div class="card">
      <h3 style="margin:6px 0 10px">å¡«å¯«å‡ºè²¨è³‡æ–™</h3>
      <form id="orderForm" class="form" onsubmit="submitOrder(event)">
        <div class="two">
          <div><div class="label">å…¬å¸/åº—åï¼ˆæˆ–å§“åï¼‰</div><input class="input" name="buyer" required></div>
          <div><div class="label">è¯çµ¡é›»è©±</div><input class="input" name="phone" required></div>
        </div>
        <div class="two">
          <div><div class="label">Emailï¼ˆæ”¶é€šçŸ¥ï¼‰</div><input class="input" name="email" type="email" required></div>
          <div><div class="label">LINE IDï¼ˆé¸å¡«ï¼‰</div><input class="input" name="line"></div>
        </div>
        <div class="two">
          <div><div class="label">æ”¶ä»¶äºº</div><input class="input" name="recipient" required></div>
          <div><div class="label">å‡ºè²¨æ–¹å¼</div>
            <select name="ship_note" class="input" required>
              <option value="å¸¸æº«é…é€">å¸¸æº«é…é€</option>
              <option value="å†·è—é…é€">å†·è—é…é€</option>
              <option value="å†·å‡é…é€">å†·å‡é…é€</option>
              <option value="è¶…å•†å–è²¨">è¶…å•†å–è²¨ï¼ˆé™å¯å¯„å“é …ï¼‰</option>
            </select>
          </div>
        </div>
        <div><div class="label">æ”¶ä»¶åœ°å€ / å–è²¨é–€å¸‚</div><input class="input" name="address" required></div>
        <div><div class="label">å‚™è¨»</div><textarea class="input" name="memo" rows="3" placeholder="å¦‚éœ€çµ±ç·¨æŠ¬é ­ã€æŒ‡å®šåˆ°è²¨æ—¥ã€é–‹ç®±éŒ„å½±ç­‰è«‹å¡«å¯«"></textarea></div>

        <div class="bank">
          <strong>åŒ¯æ¬¾è³‡è¨Šï¼š</strong>
          <div class="fine">æˆ¶åï¼šé…¥å‘³é¦™ä¼æ¥­ç¤¾ï½œéŠ€è¡Œï¼šXXXXï¼ˆä»£ç¢¼ 000ï¼‰ï½œå¸³è™Ÿï¼š0000000000000<br>å®Œæˆé€å‡ºå¾Œè«‹åŒ¯æ¬¾ï¼Œ<b>ç•™è¨€åŒ¯æ¬¾å¾Œäº”ç¢¼</b>ï¼›æˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ï¼ˆç´„ 3â€“5 å€‹å·¥ä½œå¤©ï¼‰ã€‚</div>
        </div>
        <div class="fine">é€å‡ºå¾Œç³»çµ±æœƒå°‡è¨‚å–®å¯«å…¥ Google è©¦ç®—è¡¨ä¸¦å¯„é€ç¢ºèªä¿¡è‡³æ‚¨çš„ä¿¡ç®±ã€‚</div>
        <div class="two">
          <button type="button" class="btn" onclick="closeSheet()">å–æ¶ˆ</button>
          <button type="submit" class="btn brand">é€å‡ºè¨‚å–®ï¼ˆæœªä»˜æ¬¾ä¸å‡ºè²¨ï¼‰</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Admin (local quick edit) -->
  <button class="admin-badge btn" onclick="toggleAdmin()">ğŸ”’ ç®¡ç†å“¡</button>
  <div class="admin-pane" id="adminPane">
    <h5>å¿«é€Ÿè¨­å®šï¼ˆæœ¬æ©Ÿå„²å­˜ï¼‰</h5>
    <div class="fine">ç™»å…¥å¯†ç¢¼çµ±ä¸€ <b>111111</b>ï¼ˆåªé¡¯ç¤ºåœ¨æœ¬æ©Ÿï¼Œæœƒè¨˜éŒ„æ–¼è£ç½®ï¼‰ã€‚</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0">
      <input class="input" id="adminPass" type="password" placeholder="è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼" style="max-width:180px">
      <button class="btn" onclick="adminLogin()">ç™»å…¥</button>
      <button class="btn" onclick="saveBrand()">å„²å­˜å“ç‰Œæ–‡æ¡ˆ</button>
      <button class="btn" onclick="saveProducts()">å„²å­˜ç”¢å“ JSON</button>
    </div>
    <div class="two">
      <div>
        <div class="label">LOGO URLï¼ˆå¯è²¼ GitHub RAWï¼‰</div>
        <input class="input" id="inpLogo" placeholder="https://...png">
        <div class="label">ç¶²ç«™æ¨™é¡Œ</div>
        <input class="input" id="inpTitle" placeholder="å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²">
        <div class="label">å°é¢ä¸»æ¨™</div>
        <input class="input" id="inpHeroTitle" placeholder="å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†">
        <div class="label">å°é¢å‰¯æ¨™</div>
        <input class="input" id="inpHeroSub" placeholder="æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨">

        <div style="margin-top:10px">
          <div class="label">GitHub é€£çµ âœ RAW è½‰æ›å™¨ï¼ˆå½±ç‰‡/åœ–ç‰‡ï¼‰</div>
          <input class="input" id="ghUrl" placeholder="è²¼ä¸Š GitHub æª”æ¡ˆç¶²å€ï¼ˆå« blobï¼‰">
          <div class="two">
            <button class="btn" onclick="convertGh()">è½‰æ› RAW</button>
            <button class="btn" onclick="copyRaw()">è¤‡è£½ RAW é€£çµ</button>
          </div>
          <input class="input" id="ghRawOut" placeholder="è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡" readonly>
          <small class="fine">æ•™å­¸ï¼šæŠŠ <code>https://github.com/ç”¨æˆ¶/Repo/blob/åˆ†æ”¯/path/file.png</code> è½‰æˆ <code>https://raw.githubusercontent.com/ç”¨æˆ¶/Repo/åˆ†æ”¯/path/file.png</code>ï¼›æˆ–ç›´æ¥åœ¨åŸç¶²å€å¾Œé¢åŠ  <code>?raw=1</code>ã€‚</small>
        </div>
      </div>
      <div>
        <div class="label">ç”¢å“è³‡æ–™ï¼ˆJSONï¼šå¯æ”¹å”®åƒ¹ priceã€è¦æ ¼ specã€æ˜¯å¦å”®å®Œ soldOutã€å…é‹ freeQtyã€é‹è²» shipFeeï¼‰</div>
        <textarea id="jsonBox"></textarea>
      </div>
    </div>
    <small>ä¿®æ”¹å¾ŒæŒ‰ã€Œå„²å­˜ã€ï¼Œé‡æ–°æ•´ç†é é¢å³å¯çœ‹åˆ°è®Šæ›´ï¼ˆåªå½±éŸ¿æœ¬æ©Ÿï¼‰ã€‚</small>
  </div>

  <footer class="wrap">
    <div>é…¥å‘³é¦™ä¼æ¥­ç¤¾ï½œçµ±ç·¨ 93428964</div>
    <div>åœ°å€ï¼šå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿ</div>
    <div>é€£çµ¡é›»è©±ï¼š0933-721-978</div>
  </footer>

  <script>
    /* ===========================================================
     * 1) è³‡æ–™æ¨¡å‹ï¼ˆåªä¿ç•™å…­ç¨®åŸç‰©æ–™ï¼›å„ç•™ã€Œæ•´ä»¶ã€èˆ‡ã€Œå–®å“é …ã€ï¼‰
     *    æ¬„ä½ï¼šid, tag('A.ç²‰é¡'|'B.å†·è—åŸç‰©æ–™'|'C.å†·å‡åŸç‰©æ–™'), name, spec, price, type('æ•´ä»¶'|'å–®å“é …'),
     *         shipGroup('å¸¸æº«'|'å†·è—'|'å†·å‡'|'è¶…å•†'), shipFee, freeQty, minOrder, soldOut, img, note
     * =========================================================== */
    const DEFAULT_PRODUCTS = [
      // A.ç²‰é¡ï¼ˆå¸¸æº«ï¼‰â€” å•ƒé…¥å°ˆç”¨ç²‰
      {id:'powder_case', tag:'A.ç²‰é¡', name:'å•ƒé…¥å°ˆç”¨ç²‰', type:'æ•´ä»¶', spec:'4.5å…¬æ–¤ / 5åŒ… / 1ä»¶', price:4900, shipGroup:'å¸¸æº«', shipFee:150, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'powder_single', tag:'A.ç²‰é¡', name:'å•ƒé…¥å°ˆç”¨ç²‰', type:'å–®å“é …', spec:'4.5å…¬æ–¤ / 1åŒ…', price:980, shipGroup:'å¸¸æº«', shipFee:150, freeQty:2, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // B.å†·è—åŸç‰©æ–™ â€” å•ƒé…¥ä¹³é…ªä¸ï¼ˆå†·è—ï¼‰
      {id:'cheese_case', tag:'B.å†·è—åŸç‰©æ–™', name:'å•ƒé…¥ä¹³é…ªä¸', type:'æ•´ä»¶', spec:'1å…¬æ–¤ / 10åŒ… / 1ä»¶', price:3800, shipGroup:'å†·è—', shipFee:180, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'cheese_single', tag:'B.å†·è—åŸç‰©æ–™', name:'å•ƒé…¥ä¹³é…ªä¸', type:'å–®å“é …', spec:'1å…¬æ–¤ / 1åŒ…', price:380, shipGroup:'å†·è—', shipFee:180, freeQty:10, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥è±è§’ä»ï¼ˆå†·å‡ï¼‰
      {id:'waterchest_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥è±è§’ä»', type:'æ•´ä»¶', spec:'3å…¬æ–¤ / 4åŒ… / 1ä»¶', price:2400, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'waterchest_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥è±è§’ä»', type:'å–®å“é …', spec:'3å…¬æ–¤ / 1åŒ…', price:600, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥èŠ‹æ³¥ä¸ï¼ˆå†·å‡ï¼‰
      {id:'taro_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥èŠ‹æ³¥ä¸', type:'æ•´ä»¶', spec:'750å…¬å…‹ / 18ç›’ / 1ä»¶', price:4960, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'taro_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥èŠ‹æ³¥ä¸', type:'å–®å“é …', spec:'750å…¬å…‹ / 1ç›’', price:276, shipGroup:'å†·å‡', shipFee:200, freeQty:18, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥ç‚¸é®®å¥¶ï¼ˆå†·å‡ï¼‰
      {id:'milkfried_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‚¸é®®å¥¶', type:'æ•´ä»¶', spec:'6æ¢ / 16ç›’ / 1ä»¶', price:1696, shipGroup:'å†·å‡', shipFee:200, freeQty:2, minOrder:1, soldOut:false, img:'', note:'æ»¿2ä»¶å…é‹'},
      {id:'milkfried_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‚¸é®®å¥¶', type:'å–®å“é …', spec:'6æ¢ / 1ç›’', price:106, shipGroup:'å†·å‡', shipFee:200, freeQty:32, minOrder:1, soldOut:false, img:'', note:'â€”'},

      // C.å†·å‡åŸç‰©æ–™ â€” å•ƒé…¥ç‰¹èª¿ç‰›å¥¶ï¼ˆå†·å‡ï¼‰
      {id:'milkmix_case', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', type:'æ•´ä»¶', spec:'330æ¯«å‡ / 10ç“¶ / 1ä»¶', price:750, shipGroup:'å†·å‡', shipFee:200, freeQty:1, minOrder:1, soldOut:false, img:'', note:'æ»¿1ä»¶å…é‹'},
      {id:'milkmix_single', tag:'C.å†·å‡åŸç‰©æ–™', name:'å•ƒé…¥ç‰¹èª¿ç‰›å¥¶', type:'å–®å“é …', spec:'330æ¯«å‡ / 1ç“¶', price:75, shipGroup:'å†·å‡', shipFee:200, freeQty:10, minOrder:1, soldOut:false, img:'', note:'â€”'}
    ];

    // åƒ…ä¿ç•™æŒ‡å®šæ¨™ç±¤èˆ‡æº«å±¤
    const TAGS = ['A.ç²‰é¡', 'B.å†·è—åŸç‰©æ–™', 'C.å†·å‡åŸç‰©æ–™', 'å¸¸æº«', 'å†·è—', 'å†·å‡'];
    const GROUP_LABELS = { å¸¸æº«: 'å¸¸æº«', å†·è—: 'å†·è—', å†·å‡: 'å†·å‡' };

    /* ===========================================================
     * 2) ç‹€æ…‹èˆ‡å„²å­˜
     * =========================================================== */
    const LS_KEY_PRODUCTS = 'kensu_wholesale_products_v2';
    const LS_KEY_BRAND = 'kensu_wholesale_brand_v2';
    const LS_KEY_ADMIN = 'kensu_admin_ok_v1';

    const brand = loadBrand();
    const products = loadProducts();
    let filterOn = 'å…¨éƒ¨';
    const cart = new Map(); // id -> { product, qty }

    function loadProducts() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_PRODUCTS)) || DEFAULT_PRODUCTS; } catch { return DEFAULT_PRODUCTS; }
    }
    function loadBrand() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_BRAND)) || { logo:'', title:'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨' }; } catch { return { logo:'', title:'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²', heroTitle:'å¤œå¸‚èµ·å®¶ï¼Œèµ°é€²å…¨å°çš„é»ƒé‡‘é…¥è„†', heroSub:'æ•´ä»¶èˆ‡å–®å“é …ï½œå…ˆåŒ¯æ¬¾ï¼Œæ ¸å¸³å¾Œå‡ºè²¨' }; }
    }

    /* ===========================================================
     * 3) åˆå§‹åŒ–ï¼šå“ç‰Œæ–‡æ¡ˆ + ç¯©é¸ + å¡ç‰‡æ¸²æŸ“
     * =========================================================== */
    function applyBrand(){
      if (brand.logo) document.getElementById('logoImg').src = brand.logo;
      document.getElementById('siteTitle').textContent = brand.title || 'å•ƒé…¥è±è§’é…¥æ‰¹ç™¼å®˜ç¶²';
      document.getElementById('heroTitle').textContent = brand.heroTitle || '';
      document.getElementById('heroSub').textContent = brand.heroSub || '';
      // ç®¡ç†é¢æ¿é å¡«
      document.getElementById('inpLogo').value = brand.logo || '';
      document.getElementById('inpTitle').value = brand.title || '';
      document.getElementById('inpHeroTitle').value = brand.heroTitle || '';
      document.getElementById('inpHeroSub').value = brand.heroSub || '';
    }

    function uniqueTags(){
      // å›ºå®šç‚ºéœ€æ±‚æŒ‡å®šçš„æ¨™ç±¤ï¼ˆå«ã€Œå…¨éƒ¨ã€åœ¨ chips å…§ç¬¬ä¸€å€‹ï¼‰
      return ['å…¨éƒ¨', ...TAGS];
    }

    function renderChips(){
      const chips = document.getElementById('chips');
      chips.innerHTML = '';
      uniqueTags().forEach(t => {
        const btn = document.createElement('button');
        btn.className = 'chip' + (t === filterOn ? ' is-on' : '');
        btn.textContent = t;
        btn.onclick = () => { filterOn = t; renderGrid(); };
        chips.appendChild(btn);
      });
    }

    function matchFilter(p){
      if (filterOn === 'å…¨éƒ¨') return true;
      if (['å¸¸æº«','å†·è—','å†·å‡'].includes(filterOn)) return GROUP_LABELS[p.shipGroup] === filterOn;
      return p.tag === filterOn;
    }

    function renderGrid(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      products.filter(matchFilter).forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        const title = `${p.name}ï¼ˆ${p.type}ï¼‰`;
        card.innerHTML = `
          <div class="media">
            ${p.img ? `<img src="${p.img}" alt="${title}">` : `<span style="color:#9ca3af">(å°šæœªä¸Šå‚³åœ–ç‰‡)</span>`}
            <span class="badge">${p.tag}ï½œ${GROUP_LABELS[p.shipGroup] || p.shipGroup}</span>
            ${p.soldOut ? `<span class="soldout">å·²å”®å®Œ</span>` : ''}
          </div>
          <div class="body">
            <h3>${title}</h3>
            <div class="meta">${p.spec}</div>
            <div class="price">$${fmt(p.price)}</div>
            <button class="btn add" ${p.soldOut || p.minOrder===0 ? 'disabled' : ''} onclick="addToCart('${p.id}', ${p.minOrder || 1})">åŠ å…¥è³¼ç‰©è»Š</button>
            <div class="note">é‹è²» $${p.shipFee}${p.freeQty>0?`ãƒ»æ»¿${p.freeQty}ä»¶å…é‹`:''}${p.note?`ï½œ${p.note}`:''}</div>
          </div>`;
        grid.appendChild(card);
      });
    }

    function fmt(n){ return Number(n).toLocaleString('zh-TW'); }
    function scrollToStore(){ document.getElementById('store').scrollIntoView({ behavior:'smooth' }); }

    /* ===========================================================
     * 4) è³¼ç‰©è»Šï¼šåŠ å…¥ / æ¸²æŸ“ / é‹è²»è¨ˆç®—
     *    éœ€æ±‚ï¼šåŠ å…¥å•†å“æ™‚ã€Œä¸è·³è½‰è³¼ç‰©è»Šé ã€â†’ åƒ…é¡¯ç¤ºæç¤ºï¼Œæ•¸é‡åªå…è¨± +/-
     * =========================================================== */
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = 'position:fixed;left:50%;bottom:90px;transform:translateX(-50%);background:#111;color:#fff;padding:8px 12px;border-radius:10px;font-size:13px;opacity:.96;z-index:120';
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 1500);
    }

    function addToCart(pid, qty=1){
      const p = products.find(x => x.id === pid);
      if(!p) return;
      const row = cart.get(pid) || { product: p, qty: 0 };
      row.qty += qty;
      cart.set(pid, row);
      updateCartCount();
      renderCart();
      toast('å·²åŠ å…¥è³¼ç‰©è»Š'); // ä¸è‡ªå‹•æ‰“é–‹è³¼ç‰©è»Š
    }

    function updateCartCount(){
      let totalQty = 0; cart.forEach(v => totalQty += v.qty);
      document.getElementById('cartCount').textContent = totalQty;
    }

    function openCart(){ document.getElementById('drawer').classList.add('on'); }
    function closeCart(){ document.getElementById('drawer').classList.remove('on'); }

    function renderCart(){
      const list = document.getElementById('cartList');
      list.innerHTML = '';
      let sub = 0; let groups = {};
      cart.forEach(({product, qty}) => {
        sub += product.price * qty;
        const g = product.shipGroup;
        groups[g] ||= { qty: 0, feeMax: 0, freeCandidates: [], name: GROUP_LABELS[g] || g };
        groups[g].qty += qty;
        groups[g].feeMax = Math.max(groups[g].feeMax, Number(product.shipFee) || 0);
        if(product.freeQty > 0) groups[g].freeCandidates.push(product.freeQty);

        const item = document.createElement('div');
        item.className = 'item';
        const subLine = product.price * qty;
        item.innerHTML = `
          <div style="width:56px;height:56px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#f3f4f6;display:grid;place-items:center">${product.img?`<img src="${product.img}" style="width:100%;height:100%;object-fit:cover">`:'â€”'}</div>
          <div>
            <div style="font-weight:700">${product.name}ï¼ˆ${product.type}ï¼‰</div>
            <div class="item-sub">${product.spec}ï½œå–®åƒ¹ $${fmt(product.price)}ï½œå°è¨ˆ $${fmt(subLine)}ï½œ${GROUP_LABELS[product.shipGroup]||product.shipGroup}</div>
          </div>
          <div class="qty">
            <button onclick="decQty('${product.id}')">âˆ’</button>
            <div>${qty}</div>
            <button onclick="incQty('${product.id}')">ï¼‹</button>
          </div>`;
        list.appendChild(item);
      });

      const sum = document.getElementById('cartSummary');
      let ship = 0; let shipRows = '';
      Object.entries(groups).forEach(([key, g]) => {
        const groupFreeQty = g.freeCandidates.length ? Math.min(...g.freeCandidates) : 0;
        const free = groupFreeQty>0 && g.qty >= groupFreeQty;
        const fee = free ? 0 : g.feeMax;
        ship += fee;
        const need = Math.max(0, (groupFreeQty||0) - g.qty);
        const hint = groupFreeQty ? (free ? '<span class="ok">å·²é”å…é‹</span>' : `<span class="warn">å°šå·® ${need} ä»¶å…é‹</span>`) : '<em>æ­¤ç¾¤çµ„ç„¡å…é‹</em>';
        shipRows += `<div class="row"><div>${g.name} é‹è²»</div><div>$${fmt(fee)}ã€€${hint}</div></div>`;
      });
      const total = sub + ship;

      // æ˜ç´°ï¼šç¸½ä»¶æ•¸ã€ç¾¤çµ„ä»¶æ•¸
      let totalQty = 0; cart.forEach(v => totalQty += v.qty);
      let groupDetail = Object.entries(groups).map(([k,g])=>`${g.name}:${g.qty}ä»¶`).join('ã€');

      sum.innerHTML = `
        <div class="row"><div>å•†å“å°è¨ˆ</div><div>$${fmt(sub)}</div></div>
        <div class="row"><div>ä»¶æ•¸æ˜ç´°</div><div>${totalQty} ä»¶ï¼ˆ${groupDetail||'â€”'}ï¼‰</div></div>
        ${shipRows || '<div class="row"><div>é‹è²»</div><div>$0</div></div>'}
        <div class="row" style="border-top:1px solid var(--border);padding-top:8px;font-weight:900"><div>æ‡‰ä»˜ç¸½é¡</div><div>$${fmt(total)}</div></div>
        <div class="fine">ï¼Šä¸åŒæº«å±¤åˆ†é–‹è¨ˆç®—é‹è²»èˆ‡å…é‹é–€æª»ï¼›å¯¦éš›å‡ºè²¨ä»¥åŒ¯æ¬¾æ ¸å¸³ç‚ºæº–ã€‚</div>`;
    }

    function incQty(pid){ const row = cart.get(pid); if(!row) return; row.qty++; cart.set(pid,row); updateCartCount(); renderCart(); }
    function decQty(pid){ const row = cart.get(pid); if(!row) return; row.qty--; if(row.qty<=0) cart.delete(pid); else cart.set(pid,row); updateCartCount(); renderCart(); }

    /* ===========================================================
     * 5) çµå¸³æµç¨‹ï¼ˆå…ˆå¡«è³‡æ–™â†’é€å‡ºåˆ° Google Apps Scriptï¼‰
     * =========================================================== */
    const GAS_ENDPOINT = '';// éƒ¨ç½²å¾Œè²¼ä¸Š Web App URL

    function goCheckout(){ if(cart.size===0){ alert('è«‹å…ˆåŠ å…¥å•†å“'); return } document.getElementById('sheet').classList.add('on'); }
    function closeSheet(){ document.getElementById('sheet').classList.remove('on'); }

    async function submitOrder(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      // æ•´ç†è³¼ç‰©è»Š
      let items = []; let sub=0; let ship=0; let groups={};
      cart.forEach(({product,qty})=>{
        items.push({id:product.id,name:product.name,type:product.type,spec:product.spec,price:product.price,qty,shipGroup:product.shipGroup});
        sub += product.price*qty;
        const g=product.shipGroup; groups[g] ||= {qty:0,fee:0,freeCandidates:[]};
        groups[g].qty += qty; groups[g].fee = Math.max(groups[g].fee, product.shipFee||0); if(product.freeQty>0) groups[g].freeCandidates.push(product.freeQty);
      });
      Object.values(groups).forEach(g=>{ const fq=g.freeCandidates.length?Math.min(...g.freeCandidates):0; ship += (fq>0 && g.qty>=fq)?0:g.fee; });
      const total = sub + ship;

      const payload = {
        type:'ORDER',
        buyer: fd.get('buyer'), phone: fd.get('phone'), email: fd.get('email'), line: fd.get('line'),
        recipient: fd.get('recipient'), address: fd.get('address'), ship_note: fd.get('ship_note'), memo: fd.get('memo'),
        items, sub, ship, total, ts: new Date().toISOString()
      };

      if(!GAS_ENDPOINT){
        console.log('DEV payload â†’', payload);
        alert('å·²æ¨¡æ“¬é€å‡ºè¨‚å–®ï¼ˆå°šæœªä¸²æ¥å¾Œç«¯ï¼‰ã€‚è«‹è¨­å®š Apps Script ç¶²å€å¾Œå³å¯æ­£å¼å¯«å…¥è©¦ç®—è¡¨ä¸¦å¯„ä¿¡ã€‚
ç¸½é¡ï¼š$'+fmt(total));
        closeSheet(); closeCart(); return;
      }

      try{
        await fetch(GAS_ENDPOINT, {method:'POST', mode:'no-cors', body: JSON.stringify(payload)});
        alert('è¨‚å–®å·²é€å‡ºï¼è«‹ä¾åŒ¯æ¬¾è³‡è¨ŠåŒ¯æ¬¾ï¼Œæˆ‘å€‘æ ¸å¸³å¾Œå‡ºè²¨ã€‚');
        cart.clear(); updateCartCount(); closeSheet(); closeCart();
      }catch(err){ console.error(err); alert('é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœã€‚'); }
    }

    /* ===========================================================
     * 6) ç®¡ç†å“¡ï¼ˆæœ¬æ©Ÿï¼‰ï¼šå¯†ç¢¼ 111111ï¼ˆä¸é¡¯ç¤ºåœ¨ç•«é¢ï¼›åƒ…æœ¬æ©Ÿå­˜è¨˜éŒ„ï¼‰
     * =========================================================== */
    function toggleAdmin(){
      const pane = document.getElementById('adminPane');
      pane.classList.toggle('on');
      document.getElementById('jsonBox').value = JSON.stringify(products, null, 2);
    }
    function adminLogin(){
      const ok = localStorage.getItem(LS_KEY_ADMIN) === 'YES';
      const pass = document.getElementById('adminPass').value;
      if(ok || pass === '111111'){
        localStorage.setItem(LS_KEY_ADMIN,'YES');
        alert('å·²ç™»å…¥ï¼ˆæœ¬æ©Ÿï¼‰');
      }else{ alert('å¯†ç¢¼éŒ¯èª¤'); }
    }
    function saveBrand(){
      if(localStorage.getItem(LS_KEY_ADMIN) !== 'YES'){ alert('è«‹å…ˆç™»å…¥ç®¡ç†å“¡'); return; }
      const next = {
        logo: document.getElementById('inpLogo').value,
        title: document.getElementById('inpTitle').value,
        heroTitle: document.getElementById('inpHeroTitle').value,
        heroSub: document.getElementById('inpHeroSub').value,
      };
      localStorage.setItem(LS_KEY_BRAND, JSON.stringify(next));
      applyBrand();
      alert('å“ç‰Œæ–‡æ¡ˆå·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚');
    }
    function saveProducts(){
      if(localStorage.getItem(LS_KEY_ADMIN) !== 'YES'){ alert('è«‹å…ˆç™»å…¥ç®¡ç†å“¡'); return; }
      try{
        const obj = JSON.parse(document.getElementById('jsonBox').value||'[]');
        localStorage.setItem(LS_KEY_PRODUCTS, JSON.stringify(obj));
        alert('ç”¢å“ JSON å·²å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰ã€‚é‡æ–°æ•´ç†é é¢ä»¥å¥—ç”¨ã€‚');
      }catch{ alert('JSON æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€—è™Ÿ / æ‹¬è™Ÿã€‚') }
    }

    // GitHub âœ RAW è½‰æ›
    function githubToRaw(url){
      try{
        const u = new URL(url);
        if(u.hostname === 'github.com'){
          // /user/repo/blob/branch/path -> raw.githubusercontent.com/user/repo/branch/path
          const parts = u.pathname.split('/').filter(Boolean);
          const idx = parts.indexOf('blob');
          if(idx>0){
            const user = parts[0], repo = parts[1];
            const branch = parts[3];
            const rest = parts.slice(4).join('/');
            return `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${rest}`;
          }
        }
        // fallback: åŠ  ?raw=1
        if(!url.includes('?')) return url + '?raw=1';
        return url + '&raw=1';
      }catch{ return url }
    }
    function convertGh(){ const url = document.getElementById('ghUrl').value.trim(); document.getElementById('ghRawOut').value = githubToRaw(url); }
    function copyRaw(){ const o=document.getElementById('ghRawOut'); o.select(); document.execCommand('copy'); alert('å·²è¤‡è£½ RAW é€£çµ'); }

    // å•Ÿå‹•
    applyBrand();
    renderChips();
    renderGrid();
  </script>
</body>
</html>
